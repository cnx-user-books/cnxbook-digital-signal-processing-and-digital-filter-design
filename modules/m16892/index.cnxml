<document xmlns="http://cnx.rice.edu/cnxml" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:bib="http://bibtexml.sf.net/">
  <title>Least Squared Error Design of FIR Filters</title>
  <metadata xmlns:md="http://cnx.rice.edu/mdml">
  <md:content-id>m16892</md:content-id>
  <md:title>Least Squared Error Design of FIR Filters</md:title>
  <md:abstract/>
  <md:uuid>7fa60706-c0d8-4edb-858b-92ee02a019f4</md:uuid>
</metadata>
  <content>
    <para id="id2255546">Because the integral of the square of a signal is a measure of its energy,
there is some physical reason for minimizing the integral of the squared error
<link target-id="bid0"/>, <link target-id="bid1"/>. Also, because of Parseval's theorem, a least
squares approximation in the frequency domain is a least squares
approximation in the time domain. However, minimizing the <emphasis>worst case</emphasis>
squared error induces a minimum Chebyshev error problem in some formulations
<link target-id="bid2"/>.</para>
    <section id="uid1">
      <title>Discrete Frequency Samples of Error</title>
      <para id="id2255584">If we approximate the integral squared error by the sum of the squared
error as given by</para>
      <equation id="uid2"><m:math mode="display">
          <m:mtable displaystyle="true">
            <m:mtr>
              <m:mtd columnalign="right">
                <m:mi>q</m:mi>
              </m:mtd>
              <m:mtd>
                <m:mo>=</m:mo>
              </m:mtd>
              <m:mtd columnalign="left">
                <m:mrow>
                  <m:mfrac>
                    <m:mn>1</m:mn>
                    <m:mi>L</m:mi>
                  </m:mfrac>
                  <m:munderover>
<m:mrow>
                    <m:mo>∑</m:mo>
</m:mrow>        
            <m:mrow>
                      <m:mi>k</m:mi>
                      <m:mo>=</m:mo>
                      <m:mn>0</m:mn>
                    </m:mrow>
                    <m:mrow>
                      <m:mi>L</m:mi>
                      <m:mo>-</m:mo>
                      <m:mn>1</m:mn>
                    </m:mrow>
                  </m:munderover>
                  <m:msup>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:mi>A</m:mi>
                      <m:mrow>
                        <m:mo>(</m:mo>
                        <m:msub>
                          <m:mi>ω</m:mi>
                          <m:mi>k</m:mi>
                        </m:msub>
                        <m:mo>)</m:mo>
                      </m:mrow>
                      <m:mo>-</m:mo>
                      <m:msub>
                        <m:mi>A</m:mi>
                        <m:mi>d</m:mi>
                      </m:msub>
                      <m:mrow>
                        <m:mo>(</m:mo>
                        <m:msub>
                          <m:mi>ω</m:mi>
                          <m:mi>k</m:mi>
                        </m:msub>
                        <m:mo>)</m:mo>
                      </m:mrow>
                      <m:mo>)</m:mo>
                    </m:mrow>
                    <m:mn>2</m:mn>
                  </m:msup>
                  <m:mo>=</m:mo>
                  <m:mfrac>
                    <m:mn>1</m:mn>
                    <m:mi>L</m:mi>
                  </m:mfrac>
                  <m:munderover>
<m:mrow>         
           <m:mo>∑</m:mo>
</m:mrow>        
            <m:mrow>
                      <m:mi>k</m:mi>
                      <m:mo>=</m:mo>
                      <m:mn>0</m:mn>
                    </m:mrow>
                    <m:mrow>
                      <m:mi>L</m:mi>
                      <m:mo>-</m:mo>
                      <m:mn>1</m:mn>
                    </m:mrow>
                  </m:munderover>
                  <m:mi>e</m:mi>
                  <m:msup>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:msub>
                        <m:mi>ω</m:mi>
                        <m:mi>k</m:mi>
                      </m:msub>
                      <m:mo>)</m:mo>
                    </m:mrow>
                    <m:mn>2</m:mn>
                  </m:msup>
                </m:mrow>
              </m:mtd>
            </m:mtr>
            <m:mtr>
              <m:mtd/>
              <m:mtd>
                <m:mo>≈</m:mo>
              </m:mtd>
              <m:mtd columnalign="left">
                <m:mrow>
                  <m:msubsup>
                    <m:mo>∫</m:mo>
                    <m:mn>0</m:mn>
                    <m:mi>π</m:mi>
                  </m:msubsup>
                  <m:msup>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:mi>A</m:mi>
                      <m:mrow>
                        <m:mo>(</m:mo>
                        <m:mi>ω</m:mi>
                        <m:mo>)</m:mo>
                      </m:mrow>
                      <m:mo>-</m:mo>
                      <m:msub>
                        <m:mi>A</m:mi>
                        <m:mi>d</m:mi>
                      </m:msub>
                      <m:mrow>
                        <m:mo>(</m:mo>
                        <m:mi>ω</m:mi>
                        <m:mo>)</m:mo>
                      </m:mrow>
                      <m:mo>)</m:mo>
                    </m:mrow>
                    <m:mn>2</m:mn>
                  </m:msup>
                  <m:mspace width="0.166667em"/>
                  <m:mi>d</m:mi>
                  <m:mi>ω</m:mi>
                  <m:mo>=</m:mo>
                  <m:msubsup>
                    <m:mo>∫</m:mo>
                    <m:mn>0</m:mn>
                    <m:mi>π</m:mi>
                  </m:msubsup>
                  <m:mi>e</m:mi>
                  <m:msup>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:mi>ω</m:mi>
                      <m:mo>)</m:mo>
                    </m:mrow>
                    <m:mn>2</m:mn>
                  </m:msup>
                  <m:mspace width="0.166667em"/>
                  <m:mi>d</m:mi>
                  <m:mi>ω</m:mi>
                </m:mrow>
              </m:mtd>
            </m:mtr>
          </m:mtable>
        </m:math>
      </equation>
      <para id="id2256090">where the approximation error as a function of frequency is
defined by <m:math><m:mrow><m:mi>e</m:mi><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow><m:mo>=</m:mo><m:mi>A</m:mi><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow><m:mo>-</m:mo><m:msub><m:mi>A</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> with <m:math><m:mrow><m:mi>A</m:mi><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:math> being the
amplitude response of the filter and <m:math><m:mrow><m:msub><m:mi>A</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> being the desired
amplitude response or the ideal response. The matrix statement for the
error vector becomes</para>
      <equation id="uid3">
        <m:math mode="display">
          <m:mrow>
            <m:mi>ϵ</m:mi>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:mi mathvariant="bold">A</m:mi>
            <m:mo>-</m:mo>
            <m:msub>
              <m:mi mathvariant="bold">A</m:mi>
              <m:mi mathvariant="bold">d</m:mi>
            </m:msub>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:mi mathvariant="bold">C</m:mi>
            <m:mspace width="0.166667em"/>
            <m:mi mathvariant="bold">a</m:mi>
            <m:mo>-</m:mo>
            <m:msub>
              <m:mi mathvariant="bold">A</m:mi>
              <m:mi mathvariant="bold">d</m:mi>
            </m:msub>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2256257">where <m:math><m:mi mathvariant="bold">C</m:mi></m:math> is the matrix of cosines from <link document="m16889" target-id="uid44">Equation 48 from FIR Digital Filters</link>,
<m:math><m:mi mathvariant="bold">a</m:mi></m:math> is the vector of half of the filter coefficients from
<link document="m16889" target-id="uid44">Equation 48 from FIR Digital Filters</link>, and <m:math><m:msub><m:mi mathvariant="bold">A</m:mi><m:mi mathvariant="bold">d</m:mi></m:msub></m:math> is the vector of samples of the ideal desired
amplitude response. The number of samples of the amplitude response is <m:math><m:mi>L</m:mi></m:math>
which should be five to twenty times the length of the filter to give a
good approximation of the integral in most cases. The error to be
minimized is</para>
      <equation id="uid4">
        <m:math mode="display">
          <m:mrow>
            <m:mi>q</m:mi>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:mrow>
              <m:msup>
                <m:mi>ϵ</m:mi>
                <m:mi mathvariant="bold">T</m:mi>
              </m:msup>
              <m:mi>ϵ</m:mi>
            </m:mrow>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2256355">except for a scale factor of <m:math><m:mfrac><m:mn>1</m:mn><m:mi>L</m:mi></m:mfrac></m:math>.</para>
      <para id="id2256374">This could also be posed for the general phase problem by using
<m:math><m:mrow><m:mi>H</m:mi><m:mo>(</m:mo><m:msub><m:mi>ω</m:mi><m:mi>k</m:mi></m:msub><m:mo>)</m:mo></m:mrow></m:math> rather than <m:math><m:mrow><m:mi>A</m:mi><m:mo>(</m:mo><m:msub><m:mi>ω</m:mi><m:mi>k</m:mi></m:msub><m:mo>)</m:mo></m:mrow></m:math> and <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math>, the actual impulse
response, rather than <m:math><m:mrow><m:mi>a</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math>, a nomralized half of the impulse response.</para>
      <section id="uid5">
        <title>Truncated frequency sampling design using the inverse FFT or IDCT</title>
        <para id="id2256464">The design problem is posed by defining an error measure <m:math><m:mi>q</m:mi></m:math> as a sum of
the squared differences between the actual and the desired frequency
response over a set of <m:math><m:mi>L</m:mi></m:math> frequency samples. This error function is
defined as</para>
        <equation id="uid6"><m:math mode="display">
            <m:mrow>
              <m:mi>q</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:mfrac>
                <m:mn>1</m:mn>
                <m:mi>L</m:mi>
              </m:mfrac>
              <m:munderover>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow>        
        <m:mrow>
                  <m:mi>k</m:mi>
                  <m:mo>=</m:mo>
                  <m:mn>0</m:mn>
                </m:mrow>
                <m:mrow>
                  <m:mi>L</m:mi>
                  <m:mo>-</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
              </m:munderover>
              <m:msup>
                <m:mrow>
                  <m:mo>|</m:mo>
                  <m:mi>H</m:mi>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mi>k</m:mi>
                    </m:msub>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>-</m:mo>
                  <m:msub>
                    <m:mi>H</m:mi>
                    <m:mi>d</m:mi>
                  </m:msub>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mi>k</m:mi>
                    </m:msub>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>|</m:mo>
                </m:mrow>
                <m:mn>2</m:mn>
              </m:msup>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2256586">where <m:math><m:mrow><m:msub><m:mi>H</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:msub><m:mi>ω</m:mi><m:mi>k</m:mi></m:msub><m:mo>)</m:mo></m:mrow></m:mrow></m:math> are the <m:math><m:mi>L</m:mi></m:math> samples of the desired response. This
problem is easier to formulate and solve if the frequency samples
are equally spaced as in <link document="m16891" target-id="uid16">Equation 8 from FIR Filter Design by Frequency Sampling or Interpolation</link> which gives</para>
        <equation id="uid7">
          <m:math mode="display">
            <m:mrow>
              <m:msub>
                <m:mi>ω</m:mi>
                <m:mi>k</m:mi>
              </m:msub>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:mn>2</m:mn>
              <m:mi>π</m:mi>
              <m:mi>k</m:mi>
              <m:mo>/</m:mo>
              <m:mi>L</m:mi>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2256670">and the problem is restricted to linear-phase filters where the
real-valued amplitude <m:math><m:mrow><m:mi>A</m:mi><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:math> can be approximated rather than the
complex frequency response <m:math><m:mrow><m:mi>H</m:mi><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:math>. For approximations to a complex
response, see <link target-id="uid90">"Complex and Minimum Phase Approximation"</link>.</para>
        <para id="id2256716">Linear phase and equally spaced samples cause <link target-id="uid6"/> to become</para>
        <equation id="uid8"><m:math mode="display">
            <m:mrow>
              <m:mi>q</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:mfrac>
                <m:mn>1</m:mn>
                <m:mi>L</m:mi>
              </m:mfrac>
              <m:munderover>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow>        
        <m:mrow>
                  <m:mi>k</m:mi>
                  <m:mo>=</m:mo>
                  <m:mn>0</m:mn>
                </m:mrow>
                <m:mrow>
                  <m:mi>L</m:mi>
                  <m:mo>-</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
              </m:munderover>
              <m:msup>
                <m:mrow>
                  <m:mo>|</m:mo>
                  <m:mi>A</m:mi>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mn>2</m:mn>
                    <m:mi>π</m:mi>
                    <m:mi>k</m:mi>
                    <m:mo>/</m:mo>
                    <m:mi>L</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>-</m:mo>
                  <m:msub>
                    <m:mi>A</m:mi>
                    <m:mi>d</m:mi>
                  </m:msub>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mn>2</m:mn>
                    <m:mi>π</m:mi>
                    <m:mi>k</m:mi>
                    <m:mo>/</m:mo>
                    <m:mi>L</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>|</m:mo>
                </m:mrow>
                <m:mn>2</m:mn>
              </m:msup>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2256828">or with a simpler notation</para>
        <equation id="uid9"><m:math mode="display">
            <m:mrow>
              <m:mi>q</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:mfrac>
                <m:mn>1</m:mn>
                <m:mi>L</m:mi>
              </m:mfrac>
              <m:munderover>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow>        
        <m:mrow>
                  <m:mi>k</m:mi>
                  <m:mo>=</m:mo>
                  <m:mn>0</m:mn>
                </m:mrow>
                <m:mrow>
                  <m:mi>L</m:mi>
                  <m:mo>-</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
              </m:munderover>
              <m:msup>
                <m:mrow>
                  <m:mo>|</m:mo>
                  <m:msub>
                    <m:mi>A</m:mi>
                    <m:mi>k</m:mi>
                  </m:msub>
                  <m:mo>-</m:mo>
                  <m:msub>
                    <m:mi>A</m:mi>
                    <m:mrow>
                      <m:mi>d</m:mi>
                      <m:mi>k</m:mi>
                    </m:mrow>
                  </m:msub>
                  <m:mo>|</m:mo>
                </m:mrow>
                <m:mn>2</m:mn>
              </m:msup>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2256914">A very powerful property of the Fourier transform allows a straightforward
design of least-squared-error FIR filters. Parseval's Theorem,
which is based on the orthogonality of the DFT, states that the error
defined by <link target-id="uid9"/> in the frequency domain can also be calculated in the
time domain by</para>
        <equation id="uid10"><m:math mode="display">
            <m:mrow>
              <m:mi>q</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:munderover>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow>        
        <m:mrow>
                  <m:mi>n</m:mi>
                  <m:mo>=</m:mo>
                  <m:mn>0</m:mn>
                </m:mrow>
                <m:mrow>
                  <m:mi>L</m:mi>
                  <m:mo>-</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
              </m:munderover>
              <m:msup>
                <m:mrow>
                  <m:mo>|</m:mo>
                  <m:mi>h</m:mi>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>-</m:mo>
                  <m:msub>
                    <m:mi>h</m:mi>
                    <m:mi>d</m:mi>
                  </m:msub>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>|</m:mo>
                </m:mrow>
                <m:mn>2</m:mn>
              </m:msup>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2257007">where <m:math><m:mrow><m:msub><m:mi>h</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> is the length-L symmetric FIR filter that has the <m:math><m:mi>L</m:mi></m:math> frequency
response amplitude samples <m:math><m:msub><m:mi>A</m:mi><m:mrow><m:mi>d</m:mi><m:mi>k</m:mi></m:mrow></m:msub></m:math>. This may be calculated by the
frequency sampling method in the section <link document="m16889" target-id="uid20">Four Types of Linear-Phase FIR Filters</link> using the special formulas
such as <link document="m16891" target-id="uid11">Equation 8 from FIR Filter Design by Frequency Sampling or Interpolation</link> for length <m:math><m:mi>L</m:mi></m:math> or the inverse DFT. The
filter to be designed has a length-N symmetric impulse response <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math> with <m:math><m:mi>L</m:mi></m:math>
frequency response samples <m:math><m:msub><m:mi>A</m:mi><m:mi>k</m:mi></m:msub></m:math>.</para>
        <para id="id2257119">Because the filter <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math> is of length-N and symmetric, the error equation <link target-id="uid10"/>
can be split into two sums</para>
        <equation id="uid11"><m:math mode="display">
            <m:mrow>
              <m:mi>q</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:munderover>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow>        
        <m:mrow>
                  <m:mi>n</m:mi>
                  <m:mo>=</m:mo>
                  <m:mo>-</m:mo>
                  <m:mi>M</m:mi>
                </m:mrow>
                <m:mi>M</m:mi>
              </m:munderover>
              <m:mrow>
                <m:mo>|</m:mo>
              </m:mrow>
              <m:mover accent="true">
                <m:mi>h</m:mi>
                <m:mo>^</m:mo>
              </m:mover>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>n</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mo>-</m:mo>
              <m:msub>
                <m:mover accent="true">
                  <m:mi>h</m:mi>
                  <m:mo>^</m:mo>
                </m:mover>
                <m:mi>d</m:mi>
              </m:msub>
              <m:msup>
                <m:mrow>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>|</m:mo>
                </m:mrow>
                <m:mn>2</m:mn>
              </m:msup>
              <m:mo>+</m:mo>
              <m:mn>2</m:mn>
              <m:munderover>
<m:mrow>        
        <m:mo>∑</m:mo>
</m:mrow>        
        <m:mrow>
                  <m:mi>n</m:mi>
                  <m:mo>=</m:mo>
                  <m:mi>M</m:mi>
                  <m:mo>+</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>L</m:mi>
                  <m:mo>-</m:mo>
                  <m:mn>1</m:mn>
                  <m:mo>)</m:mo>
                  <m:mo>/</m:mo>
                  <m:mn>2</m:mn>
                </m:mrow>
              </m:munderover>
              <m:msup>
                <m:mrow>
                  <m:mo>|</m:mo>
                  <m:msub>
                    <m:mover accent="true">
                      <m:mi>h</m:mi>
                      <m:mo>^</m:mo>
                    </m:mover>
                    <m:mi>d</m:mi>
                  </m:msub>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>|</m:mo>
                </m:mrow>
                <m:mn>2</m:mn>
              </m:msup>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2257305">where <m:math><m:mrow><m:mover accent="true"><m:mi>h</m:mi><m:mo>^</m:mo></m:mover><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> and <m:math><m:mrow><m:msub><m:mover accent="true"><m:mi>h</m:mi><m:mo>^</m:mo></m:mover><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> are the inverse DTFTs of <m:math><m:msub><m:mi>A</m:mi><m:mi>k</m:mi></m:msub></m:math> and <m:math><m:msub><m:mi>A</m:mi><m:mrow><m:mi>d</m:mi><m:mi>k</m:mi></m:mrow></m:msub></m:math>
respectively, which means they are the <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math> and <m:math><m:mrow><m:msub><m:mi>h</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> shifted to be
symmetic about <m:math><m:mrow><m:mi>n</m:mi><m:mo>=</m:mo><m:mn>0</m:mn></m:mrow></m:math>. This requires the number of frequency samples <m:math><m:mi>L</m:mi></m:math> must
be odd.</para>
        <para id="id2257460"><link target-id="uid11"/> clearly shows that to minimize <m:math><m:mi>q</m:mi></m:math>, the <m:math><m:mi>N</m:mi></m:math> values of
<m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math> are chosen to be equal to the equivalent <m:math><m:mi>N</m:mi></m:math> values of <m:math><m:mrow><m:msub><m:mi>h</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math>
making the first sum equal zero. In other words, <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math> is obtained by
symmetrically truncating <m:math><m:mrow><m:msub><m:mi>h</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math>. The residual error is then given by the
second summation above. An examination of the residual error as a function
of <m:math><m:mi>N</m:mi></m:math> may aid in the choice of the filter length <m:math><m:mi>N</m:mi></m:math>.</para>
        <para id="id2257598">For the Type 1 linear-phase FIR filter (described in the section <link document="m16889" target-id="uid50">Four Types of Linear-Phase FIR Filters</link>)
which has an odd length <m:math><m:mi>N</m:mi></m:math> and an even-symmetric impulse
response, the <m:math><m:mi>L</m:mi></m:math> equally spaced samples of the frequency response
from <link document="m16889" target-id="uid39"> Equation ? from Fir Digital Filters</link> gives</para>
        <equation id="uid12"><m:math mode="display">
            <m:mrow>
              <m:msub>
                <m:mi>A</m:mi>
                <m:mi>k</m:mi>
              </m:msub>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:munderover>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow>   
             <m:mrow>
                  <m:mi>n</m:mi>
                  <m:mo>=</m:mo>
                  <m:mn>0</m:mn>
                </m:mrow>
                <m:mrow>
                  <m:mi>M</m:mi>
                  <m:mo>-</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
              </m:munderover>
              <m:mn>2</m:mn>
              <m:mi>h</m:mi>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>n</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mo form="prefix">cos</m:mo>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mn>2</m:mn>
                <m:mi>π</m:mi>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>M</m:mi>
                  <m:mo>-</m:mo>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mi>k</m:mi>
                <m:mo>/</m:mo>
                <m:mi>L</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mo>+</m:mo>
              <m:mi>h</m:mi>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>M</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2257734">for <m:math><m:mrow><m:mi>k</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>,</m:mo><m:mn>1</m:mn><m:mo>,</m:mo><m:mn>2</m:mn><m:mo>,</m:mo><m:mo>.</m:mo><m:mo>.</m:mo><m:mo>.</m:mo><m:mo>.</m:mo><m:mo>,</m:mo><m:mi>L</m:mi><m:mo>-</m:mo><m:mn>1</m:mn></m:mrow></m:math>, where <m:math><m:mrow><m:mi>M</m:mi><m:mo>=</m:mo><m:mo>(</m:mo><m:mi>N</m:mi><m:mo>-</m:mo><m:mn>1</m:mn><m:mo>)</m:mo><m:mo>/</m:mo><m:mn>2</m:mn></m:mrow></m:math>. This
formula was derived as a special case of the DFT applied to the Type 1
real, even-symmetric FIR filter coefficients to calculate the sampled
amplitude of the frequency response (perhaps better posed using <m:math><m:mrow><m:mi>a</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math>).
It was noted in the section <link document="m16891" target-id="uid6">Frequency Sampling Filter Design by Formulas </link> that it is also a cosine transform and
it can be shown that this transformation is orthogonal over the
independent values of <m:math><m:msub><m:mi>A</m:mi><m:mi>k</m:mi></m:msub></m:math>, just as the DFT is.</para>
        <para id="id2257850">The desired ideal amplitude gives the ideal impulse response <m:math><m:mrow><m:msub><m:mi>h</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math>
from <link document="m16889" target-id="uid39">Equation 29 from FIR Digital Filters</link> by</para>
        <equation id="uid13"><m:math mode="display">
            <m:mrow>
              <m:msub>
                <m:mi>h</m:mi>
                <m:mi>d</m:mi>
              </m:msub>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>n</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:mfrac>
                <m:mn>1</m:mn>
                <m:mi>N</m:mi>
              </m:mfrac>
              <m:mrow>
                <m:mo>[</m:mo>
                <m:msub>
                  <m:mi>A</m:mi>
                  <m:mrow>
                    <m:mi>d</m:mi>
                    <m:mn>0</m:mn>
                  </m:mrow>
                </m:msub>
                <m:mo>+</m:mo>
                <m:munderover>
<m:mrow>
                  <m:mo>∑</m:mo>
</m:mrow>        
          <m:mrow>
                    <m:mi>k</m:mi>
                    <m:mo>=</m:mo>
                    <m:mn>1</m:mn>
                  </m:mrow>
                  <m:mrow>
                    <m:mi>M</m:mi>
                    <m:mo>-</m:mo>
                    <m:mn>1</m:mn>
                  </m:mrow>
                </m:munderover>
                <m:mn>2</m:mn>
                <m:msub>
                  <m:mi>A</m:mi>
                  <m:mrow>
                    <m:mi>d</m:mi>
                    <m:mi>k</m:mi>
                  </m:mrow>
                </m:msub>
                <m:mo form="prefix">cos</m:mo>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mn>2</m:mn>
                  <m:mi>π</m:mi>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>-</m:mo>
                    <m:mi>M</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mi>k</m:mi>
                  <m:mo>/</m:mo>
                  <m:mi>N</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mo>]</m:mo>
              </m:mrow>
              <m:mo>.</m:mo>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2258009">for <m:math><m:mrow><m:mi>n</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>,</m:mo><m:mn>1</m:mn><m:mo>,</m:mo><m:mo>⋯</m:mo><m:mo>,</m:mo><m:mi>L</m:mi><m:mo>-</m:mo><m:mn>1</m:mn></m:mrow></m:math>. This is used in <link target-id="uid11"/>, and is
the ideal impulse response that is truncated and shifted to give
a causal, symmetric <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math>.</para>
        <para id="id2258070">Use of the alternative equally-spaced sampling in <link document="m16891" target-id="uid17">Equation 9 from FIR Filter Design by Frequency Sampling or Interpolation</link>, which
has no sample at zero frequency, requires <m:math><m:mrow><m:msub><m:mi>h</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> be calculated from
<link document="m16891" target-id="uid20">Equation 11 from FIR Filter Design by Frequency Sampling or Interpolation</link> and <link document="m16891" target-id="uid23">Equation 13 from FIR Filter Design by Frequency Sampling or Interpolation</link>. The Type 2 filters with even <m:math><m:mi>N</m:mi></m:math> are
developed in a similar
way and use the design formulas <link document="m16889" target-id="uid2100">Equation 36 from FIR Digital Filters</link> and <link document="m16889" target-id="uid30009">Equation 37 from FIR Digital Filters</link>. These methods are
summarized by:</para>
        <para id="id2258120"><quote id="id28370332" display="block">The filter design procedure for an odd-length Type 1
filter is to first design an odd-length-L FIR
filter by the frequency sampling method from
<link document="m16891" target-id="uid11">Equation 5 from FIR Filter Design by Frequency Sampling or Interpolation</link> or <link document="m16891" target-id="uid20"> Equation 11 from FIR Filter Design by Frequency Sampling or Interpolation</link> or the IDFT, then to
symmetrically truncate it to the desired odd-length N
and shift it to make <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math> causal.
To design an even-length Type 2 filter , start
with an even-length-L frequency-sampling design
from <link document="m16891" target-id="uid14"> Equation 7 from FIR Filter Design by Frequency Sampling or Interpolation</link> or <link document="m16891" target-id="uid23">Equation 13 from FIR Filter Design by Frequency Sampling or Interpolation</link> or the IDFT and symmetrically
truncate and shift. The resulting length-N FIR filters are
optimal LS-error approximations to the desired
frequency response over the <m:math><m:mi>L</m:mi></m:math> frequency samples.</quote>
        </para>
        <para id="id2258174">This approach can also be applied to the general arbitrary phase FIR
filter design problem.</para>
      </section>
      <section id="uid14">
        <title>Weighted, Unevenly Sampled Discrete Least Squared Error
Filter Design by Solving Simultaneous Equations</title>
        <para id="id2258190">It is sometimes desirable to formulate the least squared error design
problem using unequally-spaced frequency samples and/or a weighting
function on the error. This is not possible using the IDFT or derived
formulas above and requires a different approach to the solution.</para>
        <para id="id2258197">Samples of the amplitude response derived for <m:math><m:mi>N</m:mi></m:math> odd in <link document="m16891" target-id="uid8">Equation 2 from FIR Filter Design by Frequency Sampling or Interpolation</link> are given by</para>
        <equation id="uid15"><m:math mode="display">
            <m:mrow>
              <m:mi>A</m:mi>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:msub>
                  <m:mi>ω</m:mi>
                  <m:mi>k</m:mi>
                </m:msub>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:munderover>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow>        
        <m:mrow>
                  <m:mi>n</m:mi>
                  <m:mo>=</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
                <m:mi>M</m:mi>
              </m:munderover>
              <m:mn>2</m:mn>
              <m:mi>h</m:mi>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>M</m:mi>
                <m:mo>-</m:mo>
                <m:mi>n</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mspace width="0.166667em"/>
              <m:mo form="prefix">cos</m:mo>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:msub>
                  <m:mi>ω</m:mi>
                  <m:mi>k</m:mi>
                </m:msub>
                <m:mi>n</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mo>+</m:mo>
              <m:mi>h</m:mi>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>M</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2258317">for <m:math><m:mrow><m:mi>k</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>,</m:mo><m:mn>1</m:mn><m:mo>,</m:mo><m:mo>⋯</m:mo><m:mo>,</m:mo><m:mi>L</m:mi><m:mo>-</m:mo><m:mn>1</m:mn></m:mrow></m:math>. This relates the <m:math><m:mi>L</m:mi></m:math> frequency
samples <m:math><m:mrow><m:mi>A</m:mi><m:mo>(</m:mo><m:msub><m:mi>ω</m:mi><m:mi>k</m:mi></m:msub><m:mo>)</m:mo></m:mrow></m:math> to the M+1 independent values of the symmetric
length-N impulse response h(n). In the design problem where the <m:math><m:msub><m:mi>A</m:mi><m:mi>k</m:mi></m:msub></m:math>
are given and the values for h(n) are to be found, this represents <m:math><m:mi>L</m:mi></m:math>
equations with M+1 unknowns. Because of the symmetries of <m:math><m:mrow><m:mi>A</m:mi><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:math>
shown in <link document="m16889" target-id="uid55">Figure 5 from FIR Digital Filters</link>, only half of the <m:math><m:mi>L</m:mi></m:math> values of <m:math><m:msub><m:mi>A</m:mi><m:mi>k</m:mi></m:msub></m:math> are
independent; however, in some cases, to have proper weights on all <m:math><m:mi>L</m:mi></m:math>
samples, all must be calculated.</para>
        <para id="id2258467"><link target-id="uid15"/> sampled at <m:math><m:mi>L</m:mi></m:math> arbitrary frequencies can be
written as a matrix equation</para>
        <equation id="uid16">
          <m:math mode="display">
            <m:mrow>
              <m:mi mathvariant="bold">C</m:mi>
              <m:mi mathvariant="bold">a</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:mi mathvariant="bold">A</m:mi>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2258519">where <m:math><m:mi>a</m:mi></m:math> is an <m:math><m:mrow><m:mi>M</m:mi><m:mo>+</m:mo><m:mn>1</m:mn></m:mrow></m:math> length vector with elements which
are the first half of <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math>. <m:math><m:mi mathvariant="bold">C</m:mi></m:math> is an <m:math><m:mi>L</m:mi></m:math> by <m:math><m:mrow><m:mo>(</m:mo><m:mi>M</m:mi><m:mo>+</m:mo><m:mn>1</m:mn><m:mo>)</m:mo></m:mrow></m:math> matrix of the
cosine terms from <link target-id="uid15"/>, and <m:math><m:mi>A</m:mi></m:math> is a length-L vector of the
frequency samples <m:math><m:mrow><m:mi>A</m:mi><m:mo>(</m:mo><m:msub><m:mi>ω</m:mi><m:mi>k</m:mi></m:msub><m:mo>)</m:mo></m:mrow></m:math>.</para>
        <para id="id2258642">If the formula for the calculation of <m:math><m:mi>L</m:mi></m:math> values of the frequency
response of a length-N FIR filter in <link target-id="uid12"/> is used to define an
error vector of differences as defined in <link target-id="uid4"/> and the result is
written in the matrix formulation of <link document="m16889" target-id="uid44">Equation 48 from FIR Filter Design by Frequency Sampling or Interpolation</link>, the error becomes</para>
        <equation id="uid17">
          <m:math mode="display">
            <m:mrow>
              <m:mi mathvariant="bold">C</m:mi>
              <m:mi mathvariant="bold">a</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:mi mathvariant="bold">A</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:msub>
                <m:mi mathvariant="bold">A</m:mi>
                <m:mi mathvariant="bold">d</m:mi>
              </m:msub>
              <m:mo>+</m:mo>
              <m:mi mathvariant="bold">e</m:mi>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2258731">or</para>
        <equation id="uid18">
          <m:math mode="display">
            <m:mrow>
              <m:mi mathvariant="bold">C</m:mi>
              <m:mi mathvariant="bold">a</m:mi>
              <m:mo>-</m:mo>
              <m:msub>
                <m:mi mathvariant="bold">A</m:mi>
                <m:mi mathvariant="bold">d</m:mi>
              </m:msub>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:mi mathvariant="bold">e</m:mi>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2258785">where <m:math><m:mi mathvariant="bold">e</m:mi></m:math> is a vector of differences between the actual and desired
samples of the frequency response. The error measure defined in
<link target-id="uid6"/> becomes the quadratic form</para>
        <equation id="uid19">
          <m:math mode="display">
            <m:mrow>
              <m:mi>q</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:mrow>
                <m:msup>
                  <m:mi mathvariant="bold">e</m:mi>
                  <m:mi mathvariant="bold">T</m:mi>
                </m:msup>
                <m:mi mathvariant="bold">e</m:mi>
              </m:mrow>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2258849">For <m:math><m:mrow><m:mi>L</m:mi><m:mo>&gt;</m:mo><m:mi>N</m:mi></m:mrow></m:math>, equation <link target-id="uid16"/> is over determined and cannot, in
general, be solved for <m:math><m:mi mathvariant="bold">a</m:mi></m:math>. The filter design error measure is the
norm of <m:math><m:mi mathvariant="bold">e</m:mi></m:math>, as given in <link target-id="uid19"/>. This error measure is
minimized by making <m:math><m:mi mathvariant="bold">e</m:mi></m:math> orthogonal to the columns of <m:math><m:mi mathvariant="bold">C</m:mi></m:math> in
<link target-id="uid18"/>. Multiplying both sides of <link target-id="uid17"/> by the transpose of
<m:math><m:mi mathvariant="bold">C</m:mi></m:math> gives</para>
        <equation id="uid20">
          <m:math mode="display">
            <m:mrow>
              <m:msup>
                <m:mi mathvariant="bold">C</m:mi>
                <m:mi mathvariant="bold">T</m:mi>
              </m:msup>
              <m:mi mathvariant="bold">C</m:mi>
              <m:mi mathvariant="bold">a</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:msup>
                <m:mi mathvariant="bold">C</m:mi>
                <m:mi mathvariant="bold">T</m:mi>
              </m:msup>
              <m:msub>
                <m:mi mathvariant="bold">A</m:mi>
                <m:mi mathvariant="bold">d</m:mi>
              </m:msub>
              <m:mo>+</m:mo>
              <m:msup>
                <m:mi mathvariant="bold">C</m:mi>
                <m:mi mathvariant="bold">T</m:mi>
              </m:msup>
              <m:mi mathvariant="bold">e</m:mi>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2259031">In order for <m:math><m:mi>q</m:mi></m:math> to be minimum, <m:math><m:mi mathvariant="bold">e</m:mi></m:math> must be orthogonal to the
columns of <m:math><m:mi mathvariant="bold">C</m:mi></m:math> and, therefore, <m:math><m:mrow><m:msup><m:mi mathvariant="bold">C</m:mi><m:mi mathvariant="bold">T</m:mi></m:msup><m:mi mathvariant="bold">e</m:mi></m:mrow></m:math> must be zero. Hence,
the optimal <m:math><m:mi mathvariant="bold">a</m:mi></m:math> must satisfy the “normal equations"
<link target-id="bid3"/>, <link target-id="bid4"/>, <link target-id="bid5"/> which are</para>
        <equation id="uid21">
          <m:math mode="display">
            <m:mrow>
              <m:msup>
                <m:mi mathvariant="bold">C</m:mi>
                <m:mi mathvariant="bold">T</m:mi>
              </m:msup>
              <m:mi mathvariant="bold">C</m:mi>
              <m:mi mathvariant="bold">a</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:msup>
                <m:mi mathvariant="bold">C</m:mi>
                <m:mi mathvariant="bold">T</m:mi>
              </m:msup>
              <m:msub>
                <m:mi mathvariant="bold">A</m:mi>
                <m:mi mathvariant="bold">d</m:mi>
              </m:msub>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2259187">and which can be rewritten in terms of the pseudo-inverse
<link target-id="bid3"/>, <link target-id="bid5"/> as</para>
        <equation id="uid22">
          <m:math mode="display">
            <m:mrow>
              <m:mi mathvariant="bold">a</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:msup>
                <m:mrow>
                  <m:mo>[</m:mo>
                  <m:msup>
                    <m:mi mathvariant="bold">C</m:mi>
                    <m:mi mathvariant="bold">T</m:mi>
                  </m:msup>
                  <m:mi mathvariant="bold">C</m:mi>
                  <m:mo>]</m:mo>
                </m:mrow>
                <m:mrow>
                  <m:mo>-</m:mo>
                  <m:mn mathvariant="bold">1</m:mn>
                </m:mrow>
              </m:msup>
              <m:msup>
                <m:mi mathvariant="bold">C</m:mi>
                <m:mi mathvariant="bold">T</m:mi>
              </m:msup>
              <m:msub>
                <m:mi mathvariant="bold">A</m:mi>
                <m:mi mathvariant="bold">d</m:mi>
              </m:msub>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2259286">If <m:math><m:mrow><m:mi>L</m:mi><m:mspace width="0.166667em"/><m:mo>=</m:mo><m:mspace width="0.166667em"/><m:mi>N</m:mi></m:mrow></m:math>, this becomes the regular frequency-sampling problem
and can be solved with zero error. For the case of interest in
this section, where <m:math><m:mrow><m:mi>L</m:mi><m:mo>&gt;</m:mo><m:mi>N</m:mi></m:mrow></m:math>, there are still only <m:math><m:mrow><m:mi>M</m:mi><m:mo>+</m:mo><m:mn>1</m:mn></m:mrow></m:math> equations to be
solved. For <m:math><m:mrow><m:mi>L</m:mi><m:mo>&gt;</m:mo><m:mo>&gt;</m:mo><m:mi>N</m:mi></m:mrow></m:math>, equation <link target-id="uid12"/> may be ill-conditioned, and
<link target-id="uid22"/> should not be used to solve them. Special methods will be
necessary to avoid serious numerical problems <link target-id="bid5"/>.</para>
        <para id="id2259376">If a weighted error function is desired, <link target-id="uid6"/> is modified to give</para>
        <equation id="uid23"><m:math mode="display">
            <m:mrow>
              <m:mi>q</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:mfrac>
                <m:mn>1</m:mn>
                <m:mi>L</m:mi>
              </m:mfrac>
              <m:munderover>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow>        
        <m:mrow>
                  <m:mi>k</m:mi>
                  <m:mo>=</m:mo>
                  <m:mn>0</m:mn>
                </m:mrow>
                <m:mrow>
                  <m:mi>L</m:mi>
                  <m:mo>-</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
              </m:munderover>
              <m:msub>
                <m:mi>W</m:mi>
                <m:mi>k</m:mi>
              </m:msub>
              <m:msup>
                <m:mrow>
                  <m:mo>|</m:mo>
                  <m:mi>A</m:mi>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mi>k</m:mi>
                    </m:msub>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>-</m:mo>
                  <m:msub>
                    <m:mi>A</m:mi>
                    <m:mi>d</m:mi>
                  </m:msub>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mi>k</m:mi>
                    </m:msub>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>|</m:mo>
                </m:mrow>
                <m:mn>2</m:mn>
              </m:msup>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2259492">The normal equations of <link target-id="uid21"/> become</para>
        <equation id="uid24">
          <m:math mode="display">
            <m:mrow>
              <m:msup>
                <m:mi mathvariant="bold">C</m:mi>
                <m:mi mathvariant="bold">T</m:mi>
              </m:msup>
              <m:mi mathvariant="bold">W</m:mi>
              <m:mi mathvariant="bold">C</m:mi>
              <m:mi mathvariant="bold">a</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:msup>
                <m:mi mathvariant="bold">C</m:mi>
                <m:mi mathvariant="bold">T</m:mi>
              </m:msup>
              <m:mi mathvariant="bold">W</m:mi>
              <m:msub>
                <m:mi mathvariant="bold">A</m:mi>
                <m:mi mathvariant="bold">d</m:mi>
              </m:msub>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2259576">where <m:math><m:mi>W</m:mi></m:math> is a positive-definite matrix of the weights. If zero weights
are desired, the effect is be achieved by removing those frequencies from
the set of <m:math><m:mi>L</m:mi></m:math> frequencies, not by using a zero value weight which would
violate the vector-space conditions of a well-posed minimization problem.</para>
        <para id="id2259604">Although developed here for the linear-phase filter, <link target-id="uid24"/> is a
very general design approach for the FIR filter that allows arbitrary
phase, as well as uneven frequency sampling and a weighting function in
the error definition. For the arbitrary phase case, a complex <m:math><m:mi mathvariant="bold">F</m:mi></m:math> is
obtained from sampling <link document="m16889" target-id="uid38">Equation 28 from FIR Digital Filters</link> and the full <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math> is used. For the
special case of the equally-spaced frequency samples and linear- phase
filter with unity weighting, the solution of <link target-id="uid21"/> or <link target-id="uid24"/>
is the same as given by the frequency sampling design formulas.</para>
        <para id="id2259659">One of the important uses of the unequally spaced frequency samples is to
create a transition band between the pass and stopbands where there are no
samples. This “don't care" band does not contribute to the error measure q
and allows better approximation to occur over the pass and stopbands.</para>
        <para id="id2259673">Of the many ways to solve <link target-id="uid21"/> or <link target-id="uid24"/>, one of the easiest and most
reliable is the use of Matlab
,
which has a special command to solve this least-mean-squared error
problem. Equation <link target-id="uid22"/> should not be solved directly. For large <m:math><m:mi>L</m:mi></m:math>, it is
ill-conditioned and a direct solution will probably have large errors.
Matlab
 uses special algorithms to minimize these numerical errors.</para>
        <para id="id2259716">This approach was applied to the same problems that were solved by
frequency sampling in the previous section. For <m:math><m:mrow><m:mi>N</m:mi><m:mo>=</m:mo><m:mi>L</m:mi></m:mrow></m:math>, the same results are
obtained, thus verifying the theoretical prediction. As <m:math><m:mi>L</m:mi></m:math> becomes larger
compared to <m:math><m:mi>N</m:mi></m:math>, more control is exerted over the behavior between the
original sample points. As <m:math><m:mi>L</m:mi></m:math> becomes large compared to <m:math><m:mi>N</m:mi></m:math>, the solution
approaches the same results as obtained where the
error is defined as a continuous function of frequency and the integral of
the squared error is minimized.
Although the solution of the normal equations is a powerful and flexible
technique, it can be slow, have numerical problems, and require large
amounts of computer memory.</para>
      </section>
      <section id="uid25">
        <title>Examples of Discrete Least Squared Error Filter Design</title>
        <para id="id2259789">Here we will give examples of several least squared error designs of FIR filters.</para>
        <figure id="uid26" orient="horizontal"><media id="id28320710" alt=" This graph is labeled Length-15 FIR lowpass filter designed by least squared error. The x axis is labeled Normalized Frequency, and the y axis is labeled Amplitude Response, A. This figure consist of a box formed by the x and y axes and a line that extends perpendicularly from the y at y=14 and a line extending perpedicularly to the x axis at x=.5. In addition to this box there is a waveform that begins on the y axis just below the line perpendicular to the y axis. The waveform travels above the line and then back below and then back across the line further above the line. Then the line takes a very negative slope crossing the line perpendicular to the y axis and also the line perpendicular to the x axis. The line continues below the x axis crossing the axis just before x=.6. The line then undulates above and below the axis until the graph ends. There is an arrow pointing to the middle of the wave between existing inside the box. This arrow labels the area Achieved Amplitude and then below that is another arrow that labels the line perpendicular to the x axis Desired Amplitude."><image src="../../media/figDLSE.png" mime-type="image/png" width="419"/><image for="pdf" src="../../media/figDLSE.eps" mime-type="application/postscript"/></media>
          
        <caption>Frequency Response of Length-15 FIR Filter Designed by Least Squared Error</caption></figure>
        <para id="id2259809">As for the frequency sampling design, we see a good lowpass filter
frequency response with the actual amplitude interpolating the desired
values at different points from the frequency sampling example in
<link target-id="uid26"/> even though the length and band edge are the same.
Notice there is less over shoot but more ripple near <m:math><m:mrow><m:mi>f</m:mi><m:mo>=</m:mo><m:mn>0</m:mn></m:mrow></m:math>. The Gibbs
phenomenon is the same as for the Fourier series.</para>
        <para id="id2259840">If a transition band is introduces in the ideal amplitude response between <m:math><m:mrow><m:mi>f</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>4</m:mn></m:mrow></m:math> and <m:math><m:mrow><m:mi>f</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>6</m:mn></m:mrow></m:math>
with a straight line, the overshoot is reduced significantly but with a slightly slower transition from
the pass to stop band. This is illustrated in <link target-id="uid27"/>.</para>
        <figure id="uid27" orient="horizontal">
          <media id="id28320857" alt=""><image src="../../media/figDLSEtb.png" mime-type="image/png" width="419"/><image for="pdf" src="../../media/figDLSEtb.eps" mime-type="application/postscript"/></media>
          <caption>Frequency Response of Length-15 FIR Filter with a Transition Band Designed by Least Squared Error</caption>
        </figure>
      </section>
    </section>
    <section id="uid28">
      <title>Continuous Frequency Definition of Error</title>
      <para id="id2259915">Because the energy of a signal is the integral of the sum of the squares
of the Fourier transform magnitude and because specifications are usually
given in the frequency domain, a very reasonable error measure to
minimize is the integral squared error given by</para>
      <equation id="uid29">
        <m:math mode="display">
          <m:mrow>
            <m:mi>q</m:mi>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:mfrac>
              <m:mn>1</m:mn>
              <m:mi>π</m:mi>
            </m:mfrac>
            <m:msubsup>
              <m:mo>∫</m:mo>
              <m:mn>0</m:mn>
              <m:mi>π</m:mi>
            </m:msubsup>
            <m:msup>
              <m:mrow>
                <m:mo>|</m:mo>
                <m:msub>
                  <m:mi>A</m:mi>
                  <m:mi>d</m:mi>
                </m:msub>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>ω</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mo>-</m:mo>
                <m:mi>A</m:mi>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>ω</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mo>|</m:mo>
              </m:mrow>
              <m:mn>2</m:mn>
            </m:msup>
            <m:mspace width="0.166667em"/>
            <m:mi>d</m:mi>
            <m:mi>ω</m:mi>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2260009">where <m:math><m:mrow><m:msub><m:mi>A</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> is the desired ideal amplitude response,
<m:math><m:mrow><m:mi>A</m:mi><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow><m:mo>=</m:mo><m:msub><m:mo>∑</m:mo><m:mi>n</m:mi></m:msub><m:mi>a</m:mi><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow><m:mspace width="0.166667em"/><m:mo form="prefix">cos</m:mo><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mrow><m:mo>(</m:mo><m:mi>M</m:mi><m:mo>-</m:mo><m:mi>N</m:mi><m:mo>)</m:mo></m:mrow><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> is the achieved amplitude
response with the length <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math> related to <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math> by <link document="m16889" target-id="uid39"> Equation 29 from FIR Digital Filters</link>. This
integral squared error is approximated by the discrete squared error
defined in <link target-id="uid29"/> for <m:math><m:mrow><m:mi>L</m:mi><m:mo>&gt;</m:mo><m:mo>&gt;</m:mo><m:mi>N</m:mi></m:mrow></m:math> which in some cases is much easier to
minimize. However for some very useful cases, formulas can be found
for <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math> that minimize <link target-id="uid29"/> and that is what we will be
considering in this section.</para>
      <section id="uid30">
        <title>The Unweighted Least Integral Squared Error Approximation</title>
        <para id="id2260197">If the error measure is the unweighted integral squared error defined
in <link target-id="uid29"/>, Parseval's theorem gives the equivalent time-domain
formulation for the error to be</para>
        <equation id="uid31"><m:math mode="display">
            <m:mrow>
              <m:mi>q</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:munderover>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow>        
        <m:mrow>
                  <m:mi>n</m:mi>
                  <m:mo>=</m:mo>
                  <m:mo>-</m:mo>
                  <m:mi>∞</m:mi>
                </m:mrow>
                <m:mi>∞</m:mi>
              </m:munderover>
              <m:mrow>
                <m:mo>|</m:mo>
              </m:mrow>
              <m:msub>
                <m:mi>h</m:mi>
                <m:mi>d</m:mi>
              </m:msub>
              <m:msup>
                <m:mrow>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>-</m:mo>
                  <m:mi>h</m:mi>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>|</m:mo>
                </m:mrow>
                <m:mn>2</m:mn>
              </m:msup>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:mfrac>
                <m:mn>1</m:mn>
                <m:mi>π</m:mi>
              </m:mfrac>
              <m:msubsup>
                <m:mo>∫</m:mo>
                <m:mn>0</m:mn>
                <m:mi>π</m:mi>
              </m:msubsup>
              <m:msup>
                <m:mrow>
                  <m:mo>|</m:mo>
                  <m:msub>
                    <m:mi>A</m:mi>
                    <m:mi>d</m:mi>
                  </m:msub>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>ω</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>-</m:mo>
                  <m:mi>A</m:mi>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>ω</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>|</m:mo>
                </m:mrow>
                <m:mn>2</m:mn>
              </m:msup>
              <m:mspace width="0.166667em"/>
              <m:mi>d</m:mi>
              <m:mi>ω</m:mi>
              <m:mo>.</m:mo>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2260359">In general, this ideal response is
infinite in duration and, therefore, cannot be realized exactly by
an actual FIR filter.</para>
        <para id="id2260367">As was done in the case of the discrete error measure, we break the
infinite sum in <link target-id="uid31"/> into two parts, one of which depends on
<m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math> and the other does not.</para>
        <equation id="uid32"><m:math mode="display">
            <m:mrow>
              <m:mi>q</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
             <m:munderover>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow>        
        <m:mrow>
                  <m:mi>n</m:mi>
                  <m:mo>=</m:mo>
                  <m:mo>-</m:mo>
                  <m:mi>M</m:mi>
                </m:mrow>
                <m:mi>M</m:mi>
              </m:munderover>
              <m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mo>|</m:mo>
              </m:mrow>
              <m:msub>
                <m:mi>h</m:mi>
                <m:mi>d</m:mi>
              </m:msub>
              <m:msup>
                <m:mrow>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>-</m:mo>
                  <m:mi>h</m:mi>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>|</m:mo>
                </m:mrow>
                <m:mn>2</m:mn>
              </m:msup>
              <m:mspace width="0.166667em"/>
              <m:mo>+</m:mo>
              <m:mspace width="0.166667em"/>
              <m:mspace width="0.166667em"/>
              <m:mn>2</m:mn>
              <m:munderover>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow>        
        <m:mrow>
                  <m:mi>n</m:mi>
                  <m:mo>=</m:mo>
                  <m:mi>M</m:mi>
                  <m:mo>+</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
                <m:mi>∞</m:mi>
              </m:munderover>
              <m:msup>
                <m:mrow>
                  <m:mo>|</m:mo>
                  <m:msub>
                    <m:mi>h</m:mi>
                    <m:mi>d</m:mi>
                  </m:msub>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>|</m:mo>
                </m:mrow>
                <m:mn>2</m:mn>
              </m:msup>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2260538">Again, we see that the minimum <m:math><m:mi>q</m:mi></m:math> is achieved by using <m:math><m:mrow><m:mi>h</m:mi><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow><m:mo>=</m:mo><m:msub><m:mi>h</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math>
for <m:math><m:mrow><m:mo>-</m:mo><m:mi>M</m:mi><m:mo>≤</m:mo><m:mi>n</m:mi><m:mo>≤</m:mo><m:mi>M</m:mi></m:mrow></m:math>. In other words, the infinitely long <m:math><m:mrow><m:msub><m:mi>h</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> is
symmetrically truncated to give the optimal least integral squared error
approximation. The problem then becomes one of finding the <m:math><m:mrow><m:msub><m:mi>h</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> to
truncate.</para>
        <para id="id2260658">Here the integral definition of approximation error is used. This is
usually what we really want, but in some cases the integrals can not be
carried out and the sampled method above must be used.</para>
        <section id="uid33">
          <title>Ideal Constant Gain Passband Lowpass Filter</title>
          <para id="id2260676">Here we assume the simplest ideal lowpass single band FIR filter to have
unity passband gain for <m:math><m:mrow><m:mn>0</m:mn><m:mo>&lt;</m:mo><m:mi>ω</m:mi><m:mo>&lt;</m:mo><m:msub><m:mi>ω</m:mi><m:mn>0</m:mn></m:msub></m:mrow></m:math> and zero stopband gain for
<m:math><m:mrow><m:msub><m:mi>ω</m:mi><m:mn>0</m:mn></m:msub><m:mo>&lt;</m:mo><m:mi>ω</m:mi><m:mo>&lt;</m:mo><m:mi>π</m:mi></m:mrow></m:math> similar to those in <link document="m16889" target-id="uid86">Figure 8a from FIR Digital Filters</link> and <link target-id="uid26"/>.
This gives
</para>
          <equation id="element-610"><m:math>
<m:mrow>
<m:msub>
<m:mi>A</m:mi>
<m:mi>d</m:mi>
</m:msub>
<m:mo>(</m:mo>
<m:mi>ω</m:mi>
<m:mo>)</m:mo>
</m:mrow>
<m:mo>=</m:mo>
<m:mo>{</m:mo>
<m:mtable>
<m:mtr>
<m:mtd columnalign="left">
<m:mrow>
<m:mn>1</m:mn>
<m:mspace width="10pt"/>
<m:reln><m:lt/>
<m:reln><m:lt/>
<m:mrow>
<m:mn>0</m:mn>
</m:mrow>
<m:mrow>
<m:mi>ω</m:mi>
</m:mrow>
</m:reln>
<m:mrow>
<m:msub>
<m:mi>ω</m:mi>
<m:mn>0</m:mn>
</m:msub>
</m:mrow>
</m:reln>
</m:mrow>
</m:mtd>
</m:mtr>
<m:mtr>
<m:mtd columnalign="left">
<m:mrow>
<m:mn>0</m:mn>
<m:mspace width="10pt"/>
<m:reln><m:lt/>
<m:reln><m:lt/>
<m:mrow>
<m:msub>
<m:mi>ω</m:mi>
<m:mn>0</m:mn>
</m:msub>
</m:mrow>
<m:mrow>
<m:mi>ω</m:mi>
</m:mrow>
</m:reln>
<m:mrow>
<m:mi>π</m:mi>
</m:mrow>
</m:reln>
</m:mrow>
</m:mtd>
</m:mtr>
</m:mtable>
</m:math>
</equation><para id="element-219">as the ideal desired amplitude response. The ideal shifted filter
coefficients are the inverse DTFT from <link document="m16895" target-id="uid40">Equation 15 from Chebyshev or Equal Ripple Error Approximation Filters</link> of this amplitude which
for <m:math><m:mi>N</m:mi></m:math> odd are given by</para><equation id="uid35">
            <m:math mode="display">
              <m:mrow>
                <m:msub>
                  <m:mover accent="true">
                    <m:mi>h</m:mi>
                    <m:mo>^</m:mo>
                  </m:mover>
                  <m:mi>d</m:mi>
                </m:msub>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mo>=</m:mo>
                <m:mspace width="0.166667em"/>
                <m:mfrac>
                  <m:mn>1</m:mn>
                  <m:mi>π</m:mi>
                </m:mfrac>
                <m:msubsup>
                  <m:mo>∫</m:mo>
                  <m:mn>0</m:mn>
                  <m:mi>π</m:mi>
                </m:msubsup>
                <m:msub>
                  <m:mi>A</m:mi>
                  <m:mi>d</m:mi>
                </m:msub>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>ω</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mo form="prefix">cos</m:mo>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>ω</m:mi>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mi>d</m:mi>
                <m:mi>ω</m:mi>
              </m:mrow>
            </m:math>
          </equation>
          <equation id="uid36">
            <m:math mode="display">
              <m:mrow>
                <m:mo>=</m:mo>
                <m:mfrac>
                  <m:mn>1</m:mn>
                  <m:mi>π</m:mi>
                </m:mfrac>
                <m:msubsup>
                  <m:mo>∫</m:mo>
                  <m:mn>0</m:mn>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mn>0</m:mn>
                  </m:msub>
                </m:msubsup>
                <m:mo form="prefix">cos</m:mo>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>ω</m:mi>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mi>d</m:mi>
                <m:mi>ω</m:mi>
                <m:mo>=</m:mo>
                <m:mfenced separators="" open="(" close=")">
                  <m:mfrac>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mi>π</m:mi>
                  </m:mfrac>
                </m:mfenced>
                <m:mspace width="0.166667em"/>
                <m:mfrac>
                  <m:mrow>
                    <m:mo form="prefix">sin</m:mo>
                    <m:mo>(</m:mo>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mi>n</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mrow>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mi>n</m:mi>
                  </m:mrow>
                </m:mfrac>
              </m:mrow>
            </m:math>
          </equation>
          <para id="id2260973">which is sometimes called a “sinc" function. Note <m:math><m:mrow><m:msub><m:mover accent="true"><m:mi>h</m:mi><m:mo>^</m:mo></m:mover><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> is
generally infinite in length. This is now symmetrically
truncated and shifted by <m:math><m:mrow><m:mi>M</m:mi><m:mo>=</m:mo><m:mo>(</m:mo><m:mi>N</m:mi><m:mo>-</m:mo><m:mn>1</m:mn><m:mo>)</m:mo><m:mo>/</m:mo><m:mn>2</m:mn></m:mrow></m:math> to give the optimal, causal length-<m:math><m:mi>N</m:mi></m:math> FIR
filter coefficients as</para>
          <equation id="uid37">
            <m:math mode="display">
              <m:mrow>
                <m:mi>h</m:mi>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mo>=</m:mo>
                <m:mspace width="0.166667em"/>
                <m:mfenced separators="" open="(" close=")">
                  <m:mfrac>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mi>π</m:mi>
                  </m:mfrac>
                </m:mfenced>
                <m:mfrac>
                  <m:mrow>
                    <m:mo form="prefix">sin</m:mo>
                    <m:mo>(</m:mo>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:mi>n</m:mi>
                      <m:mo>-</m:mo>
                      <m:mi>M</m:mi>
                      <m:mo>)</m:mo>
                    </m:mrow>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mrow>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:mi>n</m:mi>
                      <m:mo>-</m:mo>
                      <m:mi>M</m:mi>
                      <m:mo>)</m:mo>
                    </m:mrow>
                  </m:mrow>
                </m:mfrac>
                <m:mspace width="4.pt"/>
                <m:mspace width="4.pt"/>
                <m:mspace width="4.pt"/>
                <m:mtext>for</m:mtext>
                <m:mspace width="4.pt"/>
                <m:mrow>
                  <m:mn>0</m:mn>
                  <m:mo>≤</m:mo>
                  <m:mi>n</m:mi>
                  <m:mo>≤</m:mo>
                  <m:mi>N</m:mi>
                  <m:mo>-</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
              </m:mrow>
            </m:math>
          </equation>
          <para id="id2261183">and <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo><m:mo>=</m:mo><m:mn>0</m:mn></m:mrow></m:math> otherwise.
The corresponding derivation for an even length starts with the inverse
DTFT in <link document="m16923" target-id="uid11">Equation 5 from Constrained Approximation and Mixed Criteria</link> for a shifted even length filter is</para>
          <equation id="uid38">
            <m:math mode="display">
              <m:mrow>
                <m:msub>
                  <m:mover accent="true">
                    <m:mi>h</m:mi>
                    <m:mo>^</m:mo>
                  </m:mover>
                  <m:mi>d</m:mi>
                </m:msub>
                <m:mspace width="0.166667em"/>
                <m:mo>=</m:mo>
                <m:mspace width="0.166667em"/>
                <m:mfrac>
                  <m:mn>1</m:mn>
                  <m:mi>π</m:mi>
                </m:mfrac>
                <m:msubsup>
                  <m:mo>∫</m:mo>
                  <m:mn>0</m:mn>
                  <m:mi>π</m:mi>
                </m:msubsup>
                <m:msub>
                  <m:mi>A</m:mi>
                  <m:mi>d</m:mi>
                </m:msub>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>ω</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mo form="prefix">cos</m:mo>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>ω</m:mi>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>+</m:mo>
                    <m:mn>1</m:mn>
                    <m:mo>/</m:mo>
                    <m:mn>2</m:mn>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mi>d</m:mi>
                <m:mi>ω</m:mi>
                <m:mspace width="0.166667em"/>
                <m:mo>=</m:mo>
                <m:mspace width="0.166667em"/>
                <m:mfenced separators="" open="(" close=")">
                  <m:mfrac>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mi>π</m:mi>
                  </m:mfrac>
                </m:mfenced>
                <m:mspace width="0.166667em"/>
                <m:mfrac>
                  <m:mrow>
                    <m:mo form="prefix">sin</m:mo>
                    <m:mo>(</m:mo>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:mi>n</m:mi>
                      <m:mo>+</m:mo>
                      <m:mn>1</m:mn>
                      <m:mo>/</m:mo>
                      <m:mn>2</m:mn>
                      <m:mo>)</m:mo>
                    </m:mrow>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mrow>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:mi>n</m:mi>
                      <m:mo>+</m:mo>
                      <m:mn>1</m:mn>
                      <m:mo>/</m:mo>
                      <m:mn>2</m:mn>
                      <m:mo>)</m:mo>
                    </m:mrow>
                  </m:mrow>
                </m:mfrac>
              </m:mrow>
            </m:math>
          </equation>
          <para id="id2261413">which when truncated and shifted by <m:math><m:mrow><m:mi>N</m:mi><m:mo>/</m:mo><m:mn>2</m:mn></m:mrow></m:math> gives the same formula as for the
odd length design in <link target-id="uid37"/> but one should note that <m:math><m:mrow><m:mi>M</m:mi><m:mo>=</m:mo><m:mo>(</m:mo><m:mi>N</m:mi><m:mo>-</m:mo><m:mn>1</m:mn><m:mo>)</m:mo><m:mo>/</m:mo><m:mn>2</m:mn></m:mrow></m:math> is not
an integer for an even <m:math><m:mi>N</m:mi></m:math>.</para>
        </section>
        <section id="uid39">
          <title>Ideal Linearly Increasing Gain Passband Lowpass Filter</title>
          <para id="id2261487">We now derive the design formula for a filter with an ideal amplitude
response that is a linearly increasing function in the passband rather
than a constant as was assumed above. This ideal amplitude response is
given by
and illustrated in <link target-id="uid42"/>
For <m:math><m:mi>N</m:mi></m:math> odd, the ideal infinitely long shifted filter coefficients are the
inverse DTFT of this amplitude given by</para>
          <equation id="element-558"><m:math>
<m:mrow>
<m:msub>
<m:mi>A</m:mi>
<m:mi>d</m:mi>
</m:msub>
<m:mo>(</m:mo>
<m:mi>ω</m:mi>
<m:mo>)</m:mo>
</m:mrow>
<m:mo>=</m:mo>
<m:mo>{</m:mo>
<m:mtable>
<m:mtr>
<m:mtd columnalign="left">
<m:mrow>
<m:mfrac>
<m:mn>1</m:mn>
<m:mo>π</m:mo>
</m:mfrac>
<m:mi>ω</m:mi>
<m:mspace width="10pt"/>
<m:reln><m:lt/>
<m:reln><m:lt/>
<m:mrow>
<m:mn>0</m:mn>
</m:mrow>
<m:mrow>
<m:mi>ω</m:mi>
</m:mrow>
</m:reln>
<m:mrow>
<m:msub>
<m:mi>ω</m:mi>
<m:mn>0</m:mn>
</m:msub>
</m:mrow>
</m:reln>
</m:mrow>
</m:mtd>
</m:mtr>
<m:mtr>
<m:mtd columnalign="left">
<m:mrow>
<m:mn>0</m:mn>
<m:mspace width="10pt"/>
<m:reln><m:lt/>
<m:reln><m:lt/>
<m:mrow>
<m:msub>
<m:mi>ω</m:mi>
<m:mn>0</m:mn>
</m:msub>
</m:mrow>
<m:mrow>
<m:mi>ω</m:mi>
</m:mrow>
</m:reln>
<m:mrow>
<m:mi>π</m:mi>
</m:mrow>
</m:reln>
</m:mrow>


</m:mtd>
</m:mtr>
</m:mtable>
</m:math>
</equation><para id="element-682">and illustrated in <link target-id="uid42"/> For N odd, the ideal infinitely and shifted filter coefficients are the inverse DTFT of this amplitude given by</para><equation id="uid40"><m:math mode="display">
              <m:mrow>
                <m:msub>
                  <m:mover accent="true">
                    <m:mi>h</m:mi>
                    <m:mo>^</m:mo>
                  </m:mover>
                  <m:mi>d</m:mi>
                </m:msub>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mo>=</m:mo>
                <m:mspace width="0.166667em"/>
                <m:mfrac>
                  <m:mn>1</m:mn>
                  <m:mi>π</m:mi>
                </m:mfrac>
                <m:msubsup>
                  <m:mo>∫</m:mo>
                  <m:mn>0</m:mn>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mn>0</m:mn>
                  </m:msub>
                </m:msubsup>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mfrac>
                    <m:mi>ω</m:mi>
                    <m:mi>π</m:mi>
                  </m:mfrac>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mo form="prefix">cos</m:mo>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>ω</m:mi>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mi>d</m:mi>
                <m:mi>ω</m:mi>
                <m:mo>=</m:mo>
                <m:mfrac>
                  <m:mrow>
                    <m:mo form="prefix">cos</m:mo>
                    <m:mo>(</m:mo>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mi>n</m:mi>
                    <m:mo>)</m:mo>
                    <m:mo>-</m:mo>
                    <m:mn>1</m:mn>
                  </m:mrow>
                  <m:mrow>
                    <m:msup>
                      <m:mi>π</m:mi>
                      <m:mn>2</m:mn>
                    </m:msup>
                    <m:msup>
                      <m:mi>n</m:mi>
                      <m:mn>2</m:mn>
                    </m:msup>
                  </m:mrow>
                </m:mfrac>
                <m:mo>+</m:mo>
                <m:mfrac>
                  <m:mrow>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mo form="prefix">sin</m:mo>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:msub>
                        <m:mi>ω</m:mi>
                        <m:mn>0</m:mn>
                      </m:msub>
                      <m:mi>n</m:mi>
                      <m:mo>)</m:mo>
                    </m:mrow>
                  </m:mrow>
                  <m:mrow>
                    <m:msup>
                      <m:mi>π</m:mi>
                      <m:mn>2</m:mn>
                    </m:msup>
                    <m:mi>n</m:mi>
                  </m:mrow>
                </m:mfrac>
              </m:mrow>
            </m:math>
          </equation>
          <para id="id2261706">with the indeterminate <m:math><m:mrow><m:msub><m:mover accent="true"><m:mi>h</m:mi><m:mo>^</m:mo></m:mover><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mn>0</m:mn><m:mo>)</m:mo></m:mrow><m:mo>=</m:mo><m:mfrac><m:msubsup><m:mi>ω</m:mi><m:mn>0</m:mn><m:mn>2</m:mn></m:msubsup><m:mrow><m:mn>2</m:mn><m:msup><m:mi>π</m:mi><m:mn>2</m:mn></m:msup></m:mrow></m:mfrac></m:mrow></m:math>. This is now
truncated and shifted by <m:math><m:mrow><m:mi>M</m:mi><m:mo>=</m:mo><m:mo>(</m:mo><m:mi>N</m:mi><m:mo>-</m:mo><m:mn>1</m:mn><m:mo>)</m:mo><m:mo>/</m:mo><m:mn>2</m:mn></m:mrow></m:math> to give the optimal, causal length-<m:math><m:mi>N</m:mi></m:math> FIR
filter coefficients as</para>
          <equation id="uid41">
            <m:math mode="display">
              <m:mrow>
                <m:mi>h</m:mi>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mo>=</m:mo>
                <m:mspace width="0.166667em"/>
                <m:mfrac>
                  <m:mrow>
                    <m:mo form="prefix">cos</m:mo>
                    <m:mo>(</m:mo>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:mi>n</m:mi>
                      <m:mo>-</m:mo>
                      <m:mi>M</m:mi>
                      <m:mo>)</m:mo>
                    </m:mrow>
                    <m:mo>)</m:mo>
                    <m:mo>-</m:mo>
                    <m:mn>1</m:mn>
                  </m:mrow>
                  <m:mrow>
                    <m:msup>
                      <m:mi>π</m:mi>
                      <m:mn>2</m:mn>
                    </m:msup>
                    <m:msup>
                      <m:mrow>
                        <m:mo>(</m:mo>
                        <m:mi>n</m:mi>
                        <m:mo>-</m:mo>
                        <m:mi>M</m:mi>
                        <m:mo>)</m:mo>
                      </m:mrow>
                      <m:mn>2</m:mn>
                    </m:msup>
                  </m:mrow>
                </m:mfrac>
                <m:mo>+</m:mo>
                <m:mfrac>
                  <m:mrow>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mo form="prefix">sin</m:mo>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:msub>
                        <m:mi>ω</m:mi>
                        <m:mn>0</m:mn>
                      </m:msub>
                      <m:mrow>
                        <m:mo>(</m:mo>
                        <m:mi>n</m:mi>
                        <m:mo>-</m:mo>
                        <m:mi>M</m:mi>
                        <m:mo>)</m:mo>
                      </m:mrow>
                      <m:mo>)</m:mo>
                    </m:mrow>
                  </m:mrow>
                  <m:mrow>
                    <m:msup>
                      <m:mi>π</m:mi>
                      <m:mn>2</m:mn>
                    </m:msup>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:mi>n</m:mi>
                      <m:mo>-</m:mo>
                      <m:mi>M</m:mi>
                      <m:mo>)</m:mo>
                    </m:mrow>
                  </m:mrow>
                </m:mfrac>
                <m:mspace width="4.pt"/>
                <m:mspace width="4.pt"/>
                <m:mspace width="4.pt"/>
                <m:mtext>for</m:mtext>
                <m:mspace width="4.pt"/>
                <m:mrow>
                  <m:mn>0</m:mn>
                  <m:mo>≤</m:mo>
                  <m:mi>n</m:mi>
                  <m:mo>≤</m:mo>
                  <m:mi>N</m:mi>
                  <m:mo>-</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
              </m:mrow>
            </m:math>
          </equation>
          <para id="id2261992">and <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo><m:mo>=</m:mo><m:mn>0</m:mn></m:mrow></m:math> otherwise.
The corresponding derivation for an even length starts with the inverse
DTFT for a shifted even length filter in <link document="m16895" target-id="uid40">Equation 15 from Chebyshev or Equal Ripple Error Approximation Filters</link> and after shifting by
<m:math><m:mrow><m:mi>N</m:mi><m:mo>/</m:mo><m:mn>2</m:mn></m:mrow></m:math> gives the same result as <link target-id="uid41"/>.</para>
          <figure id="uid42" orient="horizontal"><media id="id28324105" alt="The graph is labeled Linearly Increasing Amplitude wiath a Lowpass Cutoff. The x axis is labeled Normalized Frequency and the y axis is Amplitude Response. The graph consist of a line extending from the origin with a positive slope and then the line proceeds straight down at x=.8 until it hits the x axis at a right angle."><image src="../../media/figLin.png" mime-type="image/png" width="419"/><image for="pdf" src="../../media/figLin.eps" mime-type="application/postscript"/></media>
            
          <caption>Ideal Frequency Response of an FIR Filter with Increasing Gain in
the Passband and Lowpass Cutoff</caption></figure>
        </section>
        <section id="uid43">
          <title>Ideal Differentiator plus Lowpass
Filter</title>
          <para id="id2262070">Fortunately the inverse DTFT for an ideal differentiator combined with a
lowpass filter can also be analytically evaluated. The ideal amplitude
response is the same as <link target-id="element-558"/> and <link target-id="uid42"/> but, since this case has an odd
symmetric impulse response, the inverse DTFT uses sine functions which for
odd <m:math><m:mi>N</m:mi></m:math> gives</para>
          <equation id="uid45">
            <m:math mode="display">
              <m:mrow>
                <m:msub>
                  <m:mover accent="true">
                    <m:mi>h</m:mi>
                    <m:mo>^</m:mo>
                  </m:mover>
                  <m:mi>d</m:mi>
                </m:msub>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mo>=</m:mo>
                <m:mspace width="0.166667em"/>
                <m:mfrac>
                  <m:mn>1</m:mn>
                  <m:mi>π</m:mi>
                </m:mfrac>
                <m:msubsup>
                  <m:mo>∫</m:mo>
                  <m:mn>0</m:mn>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mn>0</m:mn>
                  </m:msub>
                </m:msubsup>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mfrac>
                    <m:mn>1</m:mn>
                    <m:mi>π</m:mi>
                  </m:mfrac>
                  <m:mi>ω</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mo form="prefix">sin</m:mo>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>ω</m:mi>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mi>d</m:mi>
                <m:mi>ω</m:mi>
                <m:mo>=</m:mo>
                <m:mfrac>
                  <m:mrow>
                    <m:mo form="prefix">sin</m:mo>
                    <m:mo>(</m:mo>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mi>n</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mrow>
                    <m:msup>
                      <m:mi>π</m:mi>
                      <m:mn>2</m:mn>
                    </m:msup>
                    <m:msup>
                      <m:mi>n</m:mi>
                      <m:mn>2</m:mn>
                    </m:msup>
                  </m:mrow>
                </m:mfrac>
                <m:mo>-</m:mo>
                <m:mfrac>
                  <m:mrow>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mo form="prefix">cos</m:mo>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:msub>
                        <m:mi>ω</m:mi>
                        <m:mn>0</m:mn>
                      </m:msub>
                      <m:mi>n</m:mi>
                      <m:mo>)</m:mo>
                    </m:mrow>
                  </m:mrow>
                  <m:mrow>
                    <m:msup>
                      <m:mi>π</m:mi>
                      <m:mn>2</m:mn>
                    </m:msup>
                    <m:mi>n</m:mi>
                  </m:mrow>
                </m:mfrac>
              </m:mrow>
            </m:math>
          </equation>
          <para id="id2262284">with the indeterminate <m:math><m:mrow><m:msub><m:mover accent="true"><m:mi>h</m:mi><m:mo>^</m:mo></m:mover><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mn>0</m:mn><m:mo>)</m:mo></m:mrow><m:mo>=</m:mo><m:mn>0</m:mn></m:mrow></m:math>. This is now
truncated and shifted by <m:math><m:mrow><m:mi>M</m:mi><m:mo>=</m:mo><m:mo>(</m:mo><m:mi>N</m:mi><m:mo>-</m:mo><m:mn>1</m:mn><m:mo>)</m:mo><m:mo>/</m:mo><m:mn>2</m:mn></m:mrow></m:math> to give the optimal, causal length-<m:math><m:mi>N</m:mi></m:math> FIR
filter coefficients as</para>
          <equation id="uid46">
            <m:math mode="display">
              <m:mrow>
                <m:mi>h</m:mi>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mo>=</m:mo>
                <m:mfrac>
                  <m:mrow>
                    <m:mo form="prefix">sin</m:mo>
                    <m:mo>(</m:mo>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:mi>n</m:mi>
                      <m:mo>-</m:mo>
                      <m:mi>M</m:mi>
                      <m:mo>)</m:mo>
                    </m:mrow>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mrow>
                    <m:msup>
                      <m:mi>π</m:mi>
                      <m:mn>2</m:mn>
                    </m:msup>
                    <m:msup>
                      <m:mrow>
                        <m:mo>(</m:mo>
                        <m:mi>n</m:mi>
                        <m:mo>-</m:mo>
                        <m:mi>M</m:mi>
                        <m:mo>)</m:mo>
                      </m:mrow>
                      <m:mn>2</m:mn>
                    </m:msup>
                  </m:mrow>
                </m:mfrac>
                <m:mo>-</m:mo>
                <m:mfrac>
                  <m:mrow>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mo form="prefix">cos</m:mo>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:msub>
                        <m:mi>ω</m:mi>
                        <m:mn>0</m:mn>
                      </m:msub>
                      <m:mrow>
                        <m:mo>(</m:mo>
                        <m:mi>n</m:mi>
                        <m:mo>-</m:mo>
                        <m:mi>M</m:mi>
                        <m:mo>)</m:mo>
                      </m:mrow>
                      <m:mo>)</m:mo>
                    </m:mrow>
                  </m:mrow>
                  <m:mrow>
                    <m:msup>
                      <m:mi>π</m:mi>
                      <m:mn>2</m:mn>
                    </m:msup>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:mi>n</m:mi>
                      <m:mo>-</m:mo>
                      <m:mi>M</m:mi>
                      <m:mo>)</m:mo>
                    </m:mrow>
                  </m:mrow>
                </m:mfrac>
                <m:mspace width="4.pt"/>
                <m:mspace width="4.pt"/>
                <m:mspace width="4.pt"/>
                <m:mtext>for</m:mtext>
                <m:mspace width="4.pt"/>
                <m:mrow>
                  <m:mn>0</m:mn>
                  <m:mo>≤</m:mo>
                  <m:mi>n</m:mi>
                  <m:mo>≤</m:mo>
                  <m:mi>N</m:mi>
                  <m:mo>-</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
              </m:mrow>
            </m:math>
          </equation>
          <para id="id2262539">and <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo><m:mo>=</m:mo><m:mn>0</m:mn></m:mrow></m:math> otherwise.
Again the corresponding derivation for an even length gives the same
result as in <link target-id="uid46"/>. Note this very general single formula includes
as special cases the odd and even length full band (<m:math><m:mrow><m:msub><m:mi>ω</m:mi><m:mn>0</m:mn></m:msub><m:mo>=</m:mo><m:mi>π</m:mi></m:mrow></m:math>)
differentiator given in <link target-id="bid6"/>. Also note that for a full band
differentiator, an even length is much preferred because of the zero at
<m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mi>π</m:mi></m:mrow></m:math> for an odd length. However, for the differentiator with a
lowpass filter, the zero aids in the lowpass filtering and, therefore,
might be an advantage.</para>
        </section>
        <section id="uid47">
          <title>Hilbert Transformer</title>
          <para id="id2262631">The inverse DTFT for an ideal Hilbert transform <link target-id="bid7"/> combined with a
lowpass filter can also be analytically evaluated. The ideal amplitude
response is the same as <link target-id="element-610"/> but with a constant phase shift of
<m:math><m:mrow><m:mi>ϕ</m:mi><m:mo>=</m:mo><m:mi>π</m:mi><m:mo>/</m:mo><m:mn>2</m:mn></m:mrow></m:math>. Since this case has an odd symmetric impulse response,
the inverse DTFT uses sine functions which for odd <m:math><m:mi>N</m:mi></m:math> which gives</para>
          <equation id="uid49">
            <m:math mode="display">
              <m:mrow>
                <m:msub>
                  <m:mover accent="true">
                    <m:mi>h</m:mi>
                    <m:mo>^</m:mo>
                  </m:mover>
                  <m:mi>d</m:mi>
                </m:msub>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mo>=</m:mo>
                <m:mspace width="0.166667em"/>
                <m:mfrac>
                  <m:mn>1</m:mn>
                  <m:mi>π</m:mi>
                </m:mfrac>
                <m:msubsup>
                  <m:mo>∫</m:mo>
                  <m:mn>0</m:mn>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mn>0</m:mn>
                  </m:msub>
                </m:msubsup>
                <m:mo form="prefix">sin</m:mo>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>ω</m:mi>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mi>d</m:mi>
                <m:mi>ω</m:mi>
                <m:mo>=</m:mo>
                <m:mfrac>
                  <m:mrow>
                    <m:mn>1</m:mn>
                    <m:mo>-</m:mo>
                    <m:mo form="prefix">cos</m:mo>
                    <m:mo>(</m:mo>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mi>n</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mrow>
                    <m:mi>π</m:mi>
                    <m:mi>n</m:mi>
                  </m:mrow>
                </m:mfrac>
              </m:mrow>
            </m:math>
          </equation>
          <para id="id2262798">with the indeterminate <m:math><m:mrow><m:msub><m:mover accent="true"><m:mi>h</m:mi><m:mo>^</m:mo></m:mover><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mn>0</m:mn><m:mo>)</m:mo></m:mrow><m:mo>=</m:mo><m:mn>0</m:mn></m:mrow></m:math>. This is now truncated and shifted
by <m:math><m:mrow><m:mi>M</m:mi><m:mo>=</m:mo><m:mo>(</m:mo><m:mi>N</m:mi><m:mo>-</m:mo><m:mn>1</m:mn><m:mo>)</m:mo><m:mo>/</m:mo><m:mn>2</m:mn></m:mrow></m:math> to give the optimal, causal length-<m:math><m:mi>N</m:mi></m:math> FIR filter coefficients as</para>
          <equation id="uid50">
            <m:math mode="display">
              <m:mrow>
                <m:mi>h</m:mi>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mspace width="0.166667em"/>
                <m:mo>=</m:mo>
                <m:mspace width="0.166667em"/>
                <m:mfrac>
                  <m:mrow>
                    <m:mn>1</m:mn>
                    <m:mo>-</m:mo>
                    <m:mo form="prefix">cos</m:mo>
                    <m:mo>(</m:mo>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>0</m:mn>
                    </m:msub>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:mi>n</m:mi>
                      <m:mo>-</m:mo>
                      <m:mi>M</m:mi>
                      <m:mo>)</m:mo>
                    </m:mrow>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mrow>
                    <m:mi>π</m:mi>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>-</m:mo>
                    <m:mi>M</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                </m:mfrac>
                <m:mspace width="4.pt"/>
                <m:mspace width="4.pt"/>
                <m:mspace width="4.pt"/>
                <m:mrow>
                  <m:mn>0</m:mn>
                  <m:mo>≤</m:mo>
                  <m:mi>n</m:mi>
                  <m:mo>≤</m:mo>
                  <m:mi>N</m:mi>
                  <m:mo>-</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
              </m:mrow>
            </m:math>
          </equation>
          <para id="id2262983">and <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo><m:mo>=</m:mo><m:mn>0</m:mn></m:mrow></m:math> otherwise. Again the corresponding derivation for an even
length gives the same result as in <link target-id="uid50"/>. The ideal amplitude response
is shown in <link target-id="uid51"/>.</para>
          <figure id="uid51" orient="horizontal"><media id="id28325464" alt="The Cartesian graph contains in essence two squares formed by the presence of lines in both the bottom left and top left areas of the graph. In the bottom left square is formed by a line that runs along y=0, a line perpendicular to this at x=-.75. Another line runs parallel to the y=0 line from (-.75,-1) to (0,-1)Finally there is another line running vertically along x=0 from (0,-1) to (0,1). To the right of the top of this line there is a line running parallel to the y axis from (0,1) to (.75,1), and then another line extends down from (.75,1) to (.75,0). The First line at y=0 forms the bottom of this square."><image src="../../media/hilbert.png" mime-type="image/png" width="419"/><image for="pdf" src="../../media/hilbert.eps" mime-type="application/postscript"/></media>
            
          <caption>Ideal Frequency Response of an FIR Hilbert Transorm in the
Passband and Lowpass Cutoff</caption></figure>
        </section>
      </section>
      <section id="uid52">
        <title>Spline Transition Band Design</title>
        <para id="id2263050">All of the four lowpass filters described above exhibit the Gibbs
phenomenon when truncated to a finite length. To remove this effect and
to give a more explicit specification of the pass and stopband edges, a
transition band is inserted between the pass and stopband. A transition
function can be placed in this band to make the total desired amplitude
response a continuous function.</para>
        <para id="id2263060">If we use a <m:math><m:msup><m:mi>p</m:mi><m:mrow><m:mi>t</m:mi><m:mi>h</m:mi></m:mrow></m:msup></m:math> order spline as the transition function, the effect
of adding this transition band to the basic lowpass filter ideal amplitude
given in <link target-id="element-610"/> is to multiply the ideal impulse response in
<link target-id="uid36"/> by a the <m:math><m:msup><m:mi>P</m:mi><m:mrow><m:mi>t</m:mi><m:mi>h</m:mi></m:mrow></m:msup></m:math> power of a sinc function to give</para>
        <equation id="uid54">
          <m:math mode="display">
            <m:mrow>
              <m:msub>
                <m:mover accent="true">
                  <m:mi>h</m:mi>
                  <m:mo>^</m:mo>
                </m:mover>
                <m:mi>d</m:mi>
              </m:msub>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>n</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:mfrac>
                <m:mrow>
                  <m:mo form="prefix">sin</m:mo>
                  <m:mo>(</m:mo>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mn>0</m:mn>
                  </m:msub>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mrow>
                  <m:mi>π</m:mi>
                  <m:mi>n</m:mi>
                </m:mrow>
              </m:mfrac>
              <m:msup>
                <m:mfenced separators="" open="(" close=")">
                  <m:mfrac>
                    <m:mrow>
                      <m:mo form="prefix">sin</m:mo>
                      <m:mo>(</m:mo>
                      <m:mi>Δ</m:mi>
                      <m:mi>n</m:mi>
                      <m:mo>/</m:mo>
                      <m:mi>p</m:mi>
                      <m:mo>)</m:mo>
                    </m:mrow>
                    <m:mrow>
                      <m:mi>Δ</m:mi>
                      <m:mi>n</m:mi>
                      <m:mo>/</m:mo>
                      <m:mi>p</m:mi>
                    </m:mrow>
                  </m:mfrac>
                </m:mfenced>
                <m:mi>p</m:mi>
              </m:msup>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2263223">where <m:math><m:mrow><m:msub><m:mi>ω</m:mi><m:mn>0</m:mn></m:msub><m:mo>=</m:mo><m:mrow><m:mo>(</m:mo><m:msub><m:mi>ω</m:mi><m:mi>s</m:mi></m:msub><m:mo>+</m:mo><m:msub><m:mi>ω</m:mi><m:mi>p</m:mi></m:msub><m:mo>)</m:mo></m:mrow><m:mo>/</m:mo><m:mn>2</m:mn></m:mrow></m:math> is the average
band edge and <m:math><m:mrow><m:mi>Δ</m:mi><m:mo>=</m:mo><m:mo>(</m:mo><m:msub><m:mi>ω</m:mi><m:mi>s</m:mi></m:msub><m:mo>-</m:mo><m:msub><m:mi>ω</m:mi><m:mi>p</m:mi></m:msub><m:mo>)</m:mo><m:mo>/</m:mo><m:mn>2</m:mn></m:mrow></m:math> is half the transition
band width in radians per second normalized for one sample per
second sampling rate <link target-id="bid8"/>, <link target-id="bid6"/>, <link target-id="bid9"/>. The spline produces a
transition function which consists of <m:math><m:mi>p</m:mi></m:math> segments of <m:math><m:msup><m:mi>p</m:mi><m:mrow><m:mi>t</m:mi><m:mi>h</m:mi></m:mrow></m:msup></m:math> order
polynomials connected together so that <m:math><m:mrow><m:mi>p</m:mi><m:mo>-</m:mo><m:mn>1</m:mn></m:mrow></m:math> derivatives are
continuous at the junctions.</para>
        <figure id="uid55" orient="horizontal"><media id="id28325928" alt="This graph is labeled Ideal Lowpass Filter Amplitude with Order-p Spline Transition Function. The x axis is labeled Normalized frequency and the y axis is labeled Amplitude Response, A_d. At y=0 there is another line running the length of the graph. The segment of the line between (.3,0) to (.7,0) is labeled Transition Band. This graph consist of three different lines all originating at (0,1). All three of the lines start out as horizontal lines. The first line to deviate from this path is labeled p=1 and  at the point where the Transition Band starts to where it ends the line takes a negative diagonal slope. The next line to deviate from the initial horizontal path is labeled p=2, and when it reaches the area of the transition band, the line takes a gentle negative slope and then ends by curving to the right before reaching the x axis. The final line labeled P=10. This line follows the initial horizontal path the longest and then takes the most drastic negative slope of the three down (almost a vertical line) and then curves to the right just a little before ending on the x axis."><image src="../../media/figSp.png" mime-type="image/png" width="427"/><image for="pdf" src="../../media/figSp.eps" mime-type="application/postscript"/></media>
          
        <caption>Ideal Lowpass Filter Amplitude with Order-p Spline Transition
Function</caption></figure>
        <para id="id2263390">The optimal value of the exponent <m:math><m:mi>p</m:mi></m:math> is chosen as
<m:math><m:mrow><m:mi>p</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>624</m:mn><m:mo>(</m:mo><m:msub><m:mi>f</m:mi><m:mi>s</m:mi></m:msub><m:mo>-</m:mo><m:msub><m:mi>f</m:mi><m:mi>p</m:mi></m:msub><m:mo>)</m:mo><m:mi>N</m:mi></m:mrow></m:math> (for a unity sampling rate) which minimizes the
approximation error <link target-id="bid9"/>. Each of the four ideal lowpass
filters derived in the previous can have a transition band added
simply by multiplying their impulse response by the sinc weighting
function as illustrated in <link target-id="uid54"/>. <link target-id="uid55"/> shows an
ideal unity gain filter amplitude response with examples of first,
second, and tenth order spline transition functions.
<link target-id="uid56"/> shows the ideal responses of the linear gain
filter with fourth order spline transition function.</para>
        <figure id="uid56" orient="horizontal"><media id="id28326078" alt="The graph is labeled Ideal Increasing Amplitude with Spline Transition Function. The x axis is labeled Normalized Frequency and the y axis is Amplitude Response. The graph consist of a line extending from the origin with a positive slope and then the line proceeds straight down at about x=.75. Right before reaching the x axis the vertical line curves a little to the right just before (.8,0)."><image src="../../media/figSp2.png" mime-type="image/png" width="417"/><image for="pdf" src="../../media/figSp2.eps" mime-type="application/postscript"/></media>
          
        <caption>Ideal Increasing Amplitude Filter with Spline Transition
Function</caption></figure>
      </section>
      <section id="uid57">
        <title>The Optimal Multiband Least Squared Error Design
Method</title>
        <para id="id2263501">The optimal multiband design method consists of two somewhat independent
parts. The first is the design of an optimal least squares lowpass filter
with a transition band as described above or as calculated by an inverse
FFT. The second part builds an optimal multiband filter from a
combination of these optimal lowpass filters and is the main point of this
<link target-id="bid10"/>.</para>
        <para id="id2263516">The unweighted least squared error linear phase FIR filter design problem
is to find the filter coefficients that minimize the error defined by</para>
        <equation id="uid59">
          <m:math mode="display">
            <m:mrow>
              <m:mi>q</m:mi>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:msubsup>
                <m:mo>∫</m:mo>
                <m:mn>0</m:mn>
                <m:mi>π</m:mi>
              </m:msubsup>
              <m:msup>
                <m:mrow>
                  <m:mo>|</m:mo>
                  <m:mi>A</m:mi>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>ω</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>-</m:mo>
                  <m:msub>
                    <m:mi>A</m:mi>
                    <m:mi>d</m:mi>
                  </m:msub>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>ω</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>|</m:mo>
                </m:mrow>
                <m:mn>2</m:mn>
              </m:msup>
              <m:mspace width="0.166667em"/>
              <m:mi>d</m:mi>
              <m:mi>ω</m:mi>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2263601">where <m:math><m:mrow><m:mi>A</m:mi><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:math> is the amplitude frequency response of the actual filter
and <m:math><m:mrow><m:msub><m:mi>A</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> is the desired ideal amplitude response. This is done
by truncating the inverse discrete time Fourier transform of
<m:math><m:mrow><m:msub><m:mi>A</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math>. The difficulty is the analytical evaluation of the
integral in the inverse transform <link target-id="bid6"/>. If a spline transition
function is used, an analytical formula can be derived for the filter that
minimizes <link target-id="uid59"/>. The details of this result can be found in
<link target-id="bid9"/>, <link target-id="bid10"/>.</para>
        <para id="id2263698">The infinitely long filters designed from the inverse discrete time
Fourier transform of the ideal response have a frequency response which is
the same as the ideal and, therefore, has no error. An ideal desired
amplitude response can be formulated as the sum of simpler ideal lowpass
filters, differentiators or Hilbert transformers together with their
spline transition functions by</para>
        <equation id="uid60"><m:math mode="display">
            <m:mrow>
              <m:msub>
                <m:mi>A</m:mi>
                <m:mi>d</m:mi>
              </m:msub>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>ω</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:munder>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow> 
               <m:mi>k</m:mi>
              </m:munder>
              <m:msub>
                <m:mi>K</m:mi>
                <m:mi>k</m:mi>
              </m:msub>
              <m:mspace width="0.166667em"/>
              <m:msub>
                <m:mi>A</m:mi>
                <m:msub>
                  <m:mi>d</m:mi>
                  <m:mi>k</m:mi>
                </m:msub>
              </m:msub>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>ω</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mo>.</m:mo>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2263785">where <m:math><m:mrow><m:msub><m:mi>A</m:mi><m:msub><m:mi>d</m:mi><m:mi>k</m:mi></m:msub></m:msub><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> is the desired lowpass response with a transition
band in the <m:math><m:msup><m:mi>k</m:mi><m:mrow><m:mi>t</m:mi><m:mi>h</m:mi></m:mrow></m:msup></m:math> band such as given in <link target-id="element-610"/> or <link target-id="element-558"/> and
the <m:math><m:msub><m:mi>K</m:mi><m:mi>k</m:mi></m:msub></m:math> are chosen to build the desired <m:math><m:mrow><m:msub><m:mi>A</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math>. These <m:math><m:msub><m:mi>A</m:mi><m:msub><m:mi>d</m:mi><m:mi>k</m:mi></m:msub></m:msub></m:math>
are the forms considered in the previous section along with any others
that have analytical inverse DTFTs such as polynomials. Because of the
linearity of the Fourier transform, a multiband ideal response can be
constructed by simply adding and subtracting the impulse response of
appropriate ideal lowpass filters.</para>
        <equation id="uid61"><m:math mode="display">
            <m:mrow>
              <m:msub>
                <m:mover accent="true">
                  <m:mi>h</m:mi>
                  <m:mo>^</m:mo>
                </m:mover>
                <m:mi>d</m:mi>
              </m:msub>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>n</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:munder>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow>        
        <m:mi>k</m:mi>
              </m:munder>
              <m:mspace width="0.166667em"/>
              <m:msub>
                <m:mi>K</m:mi>
                <m:mi>k</m:mi>
              </m:msub>
              <m:mspace width="0.166667em"/>
              <m:mspace width="0.166667em"/>
              <m:mtext>IDTFT</m:mtext>
              <m:mrow>
                <m:mo>{</m:mo>
                <m:msub>
                  <m:mi>A</m:mi>
                  <m:msub>
                    <m:mi>d</m:mi>
                    <m:mi>k</m:mi>
                  </m:msub>
                </m:msub>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>ω</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mo>}</m:mo>
              </m:mrow>
            </m:mrow>
          </m:math>
        </equation>
        <equation id="uid62"><m:math mode="display">
            <m:mrow>
              <m:msub>
                <m:mover accent="true">
                  <m:mi>h</m:mi>
                  <m:mo>^</m:mo>
                </m:mover>
                <m:mi>d</m:mi>
              </m:msub>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>n</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mspace width="0.166667em"/>
              <m:mo>=</m:mo>
              <m:mspace width="0.166667em"/>
              <m:munder>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow>        
        <m:mi>k</m:mi>
              </m:munder>
              <m:mspace width="0.166667em"/>
              <m:msub>
                <m:mi>K</m:mi>
                <m:mi>k</m:mi>
              </m:msub>
              <m:mspace width="0.166667em"/>
              <m:msub>
                <m:mover accent="true">
                  <m:mi>h</m:mi>
                  <m:mo>^</m:mo>
                </m:mover>
                <m:msub>
                  <m:mi>d</m:mi>
                  <m:mi>k</m:mi>
                </m:msub>
              </m:msub>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>n</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
            </m:mrow>
          </m:math>
        </equation>
        <para id="id2264095">Because of the orthogonality of the basis functions of the Fourier
transform, the truncated sequence of the infinitely long impulse response
<m:math><m:mrow><m:msub><m:mover accent="true"><m:mi>h</m:mi><m:mo>^</m:mo></m:mover><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> will give an optimal approximation to <m:math><m:mrow><m:msub><m:mi>A</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> in a
least squares sense. This argument allows no error weighting or “don't
care" transition bands or traditional windowing methods. It does,
however, allow the optimized spline transition functions <link target-id="bid9"/>, <link target-id="bid10"/>.</para>
        <para id="id2264172">Using these facts, an optimal multiband filter can be built up by
successively adding and subtracting the impulse responses of optimal
lowpass filters as done in <link target-id="uid61"/>. For example a bandpass filter
that approximates zero for <m:math><m:mrow><m:mn>0</m:mn><m:mo>&lt;</m:mo><m:mi>ω</m:mi><m:mo>&lt;</m:mo><m:msub><m:mi>ω</m:mi><m:mn>1</m:mn></m:msub></m:mrow></m:math>, has a spline transition
band for <m:math><m:mrow><m:msub><m:mi>ω</m:mi><m:mn>1</m:mn></m:msub><m:mo>&lt;</m:mo><m:mi>ω</m:mi><m:mo>&lt;</m:mo><m:msub><m:mi>ω</m:mi><m:mn>2</m:mn></m:msub></m:mrow></m:math>, approximates one (or some other
constant) for <m:math><m:mrow><m:msub><m:mi>ω</m:mi><m:mn>2</m:mn></m:msub><m:mo>&lt;</m:mo><m:mi>ω</m:mi><m:mo>&lt;</m:mo><m:msub><m:mi>ω</m:mi><m:mn>3</m:mn></m:msub></m:mrow></m:math>, has an independent second
transition band for <m:math><m:mrow><m:msub><m:mi>ω</m:mi><m:mn>3</m:mn></m:msub><m:mo>&lt;</m:mo><m:mi>ω</m:mi><m:mo>&lt;</m:mo><m:msub><m:mi>ω</m:mi><m:mn>4</m:mn></m:msub></m:mrow></m:math>, and finally approximates
zero for <m:math><m:mrow><m:msub><m:mi>ω</m:mi><m:mn>4</m:mn></m:msub><m:mo>&lt;</m:mo><m:mi>ω</m:mi><m:mo>&lt;</m:mo><m:mi>π</m:mi></m:mrow></m:math> can be designed by first designing a simple
lowpass filter with transition band <m:math><m:mrow><m:msub><m:mi>ω</m:mi><m:mn>3</m:mn></m:msub><m:mo>&lt;</m:mo><m:mi>ω</m:mi><m:mo>&lt;</m:mo><m:msub><m:mi>ω</m:mi><m:mn>4</m:mn></m:msub></m:mrow></m:math> and then
subtracting from its impulse response the impulse of a second lowpass
filter designed with a transition band <m:math><m:mrow><m:msub><m:mi>ω</m:mi><m:mn>1</m:mn></m:msub><m:mo>&lt;</m:mo><m:mi>ω</m:mi><m:mo>&lt;</m:mo><m:msub><m:mi>ω</m:mi><m:mn>2</m:mn></m:msub></m:mrow></m:math>. A
filter with two or more passbands can be designed by adding the impulse
responses of two or more single passband filters.</para>
        <para id="id2264395">Indeed, a completely general design method can be formulated by
alternately adding and subtracting lowpass filters starting with the
highest frequency transition band and moving sequentially down to the
lowest. If the ideal frequency response is not zero at <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mi>π</m:mi></m:mrow></m:math>, then
one starts with a constant frequency response (an impulse in the time
domain) and subtracts a lowpass filter (remember the length must be odd
for this case). By scaling each lowpass filter, different gains are
obtained in each band.</para>
        <para id="id2264421">Care must be taken that the constructed spline transition function
properly fit the bands on both sides. This will not automatically happen
if there are two adjacent bands with different slopes connected by one
transitions function which are simply added together. It will automatically
happen if each passband is separated by a stopband or if adjacent bands
have the same slopes.</para>
      </section>
      <section id="uid63">
        <title>A Matlab Filter Design Program</title>
        <para id="id2255383">A Matlab <link target-id="bid11"/> program named fir3.m
 is given in the appendix of
this book that will design optimal filters using the method described
in the previous section. This particular program requires constant but
arbitrary passband gains and uses a format for specifications similar to
remez()
 in Matlab. It constructs the multiband filter from
<link target-id="uid62"/> by adding and subtracting optimal lowpass filters designed
from the formula in <link target-id="uid54"/> and calculated in the second program named
fir3lp.m
.</para>
        <para id="id2255424">The main program is given an even length vector f 
 containing the
normalized pass and stopband edges, including <m:math><m:mrow><m:mi>f</m:mi><m:mo>=</m:mo><m:mn>0</m:mn></m:mrow></m:math> and <m:math><m:mrow><m:mi>f</m:mi><m:mo>=</m:mo><m:mn>1</m:mn></m:mrow></m:math>. It is also
given an even length vector m 
 containing the ideal response at
each frequency in f
. Because the lowpass filter has a constant
passband, the ideal response of the multiband filter will have constant
passbands. This means m 
 will consist of adjacent terms that are
equal. An example Matlab function call is given in the next section.</para>
        <para id="id2255486">The simple program listed in the appendix will design filters with
constant gains in multiple passbands. From its construction it is easy to
see how adding the use of the linear gain lowpass filter to the unity gain
passband lowpass filter would allow designing optimal filters with linear
gains in the passbands. By adding all four basic lowpass designs a
calling program could be written that would automatically design one
filter with a combination of all four characteristics. If the real and
imaginary parts of a desired complex frequency response can be given in
terms of the basic filters, nonlinear phase filters can be designed also.</para>
        <para id="id2255500">The programs are written to be consistent with Matlab's convention of
normalizing for two samples per second sampling rate. The equations
most of this book, however, are normalized for one sample per second.</para>
      </section>
      <section id="uid64">
        <title>Design Examples</title>
        <para id="id2264712">To show the results of using this new design approach, two examples of
multiband filter design are presented here. The first is a filter with a
stopband from <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn></m:mrow></m:math> to <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>2</m:mn></m:mrow></m:math>,
a transition band from <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>2</m:mn></m:mrow></m:math> to <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>25</m:mn></m:mrow></m:math>,
a passband with gain equal
to 0.7 from <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>25</m:mn></m:mrow></m:math> to <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>5</m:mn></m:mrow></m:math>,
a transition band from <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>5</m:mn></m:mrow></m:math> to <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>55</m:mn></m:mrow></m:math>,
a passband with gain equal
to 0.5 from <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>55</m:mn></m:mrow></m:math> to <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>7</m:mn></m:mrow></m:math>,
a transition band from <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>7</m:mn></m:mrow></m:math> to <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>73</m:mn></m:mrow></m:math>,
a stopband from <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>73</m:mn></m:mrow></m:math> to <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>85</m:mn></m:mrow></m:math>,
a transition band from <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>85</m:mn></m:mrow></m:math> to <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>9</m:mn></m:mrow></m:math>, and
a passband with gain equal one from <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>9</m:mn></m:mrow></m:math> to <m:math><m:mrow><m:mi>ω</m:mi><m:mo>=</m:mo><m:mn>1</m:mn></m:mrow></m:math>. This
is called with the Matlab program by</para>
        <code id="id28327729" display="block"> 
h  = fir3(51,[0 .2 .25 .5 .55 .7 .73 .85 .9 1],[0 0 .7 .7.5 .5 0 0 1 1])
</code>
        <para id="id2265076">and the amplitude response plot shown in <link target-id="uid65"/>a. The
response for length of <m:math><m:mrow><m:mi>N</m:mi><m:mo>=</m:mo><m:mn>101</m:mn></m:mrow></m:math> is shown in Figures <link target-id="uid65"/>b and in
<link target-id="uid65"/>c the zero locations are given. </para>
        <para id="eip-671">As an example of how versatile
this approach can be, a length-101 linear phase multiband FIR filter was
designed with different types of filtering being done in different bands.
The signal with frequencies in the band from <m:math><m:mrow><m:mn>0</m:mn><m:mo>&lt;</m:mo><m:mi>f</m:mi><m:mo>&lt;</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>2</m:mn></m:mrow></m:math> is differentiated, in the
band from <m:math><m:mrow><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>23</m:mn><m:mo>&lt;</m:mo><m:mi>f</m:mi><m:mo>&lt;</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>4</m:mn></m:mrow></m:math> is rejected, in <m:math><m:mrow><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>43</m:mn><m:mo>&lt;</m:mo><m:mi>f</m:mi><m:mo>&lt;</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>6</m:mn></m:mrow></m:math> is Hilbert
transformed, in <m:math><m:mrow><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>63</m:mn><m:mo>&lt;</m:mo><m:mi>f</m:mi><m:mo>&lt;</m:mo><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>8</m:mn></m:mrow></m:math> is rejected, and <m:math><m:mrow><m:mn>0</m:mn><m:mo>.</m:mo><m:mn>83</m:mn><m:mo>&lt;</m:mo><m:mi>f</m:mi><m:mo>&lt;</m:mo><m:mn>1</m:mn><m:mo>.</m:mo><m:mn>0</m:mn></m:mrow></m:math> is highpass filtered.
In the transition bands between each of these processing bands, there is an
optimal spline transition function. The amplitude response is shown in Figure 7d. This is a truly versatile multiband
design technique with the only major limitation being that weighting is
not possible. However, that limitation is removed in the next secession.</para><figure id="uid65" orient="horizontal"><media id="id28327932" alt="This figure consist of four different graphs. The top left graph is labeled a. Length-51 Multiband FIR Filter. The y axis is labeled Magnitude Response. This graph consist of a wave form that starts with a squiggly section that is pretty much on top of the y=0 line and then the wave rises quickly at an almost vertical slope to y=.7. Then the wave squiggles til (.5 .7) where the slope takes an extremely negative slope and then it squiggles a little and the plummets back to the x axis and then squiggles a little and then takes a drastically positive slope almost to the top of the graph where is squiggles a tiny bit before running of the graph.  The second graph is labeled b. Length-201 Multiband FIR Filter. The graph is similar to the first graph but every place where there was squiggling the area is now a flat horizontal line. The bottom left graph is the most complicated of the four graphs. It is labeled c. Multiband Filter Zero Locations. the x axis is labeled Real Part of Z, and the y axis is labeled the Imaginary Part of z. In general this image consist of a large circle centered on the origin with little hollow circles in, on and around it. There three distinct areas around the perimeter of the circle where there are little hollow circles present on the perimeter of the circle. On the left hand side there are two groups of circles: one at the center of the bottom left quarter of the circle and then another at the center of the top left quarter of the circle. The other group is on the center of the right half of the circle. All of these circle groups consist of overlapping little circles. The two on the left half are groups of four circles and the one on the right half consist of 12 little circles. There are also little circles present inside the larger circle. There are three circles grouped together to the right of the left most area of the larger circle. There are six grouped together between the top left grouping of perimeter circles and the right half group and the same grouping mirror between the bottom left group of perimeter circles and the right group. There are also little circle on the outside of the larger circle. There are three to the left of the far left of the circle. There are also two groups of six circles above and below the top and bottom extremes of the circle. The final graph is more similar to first two graphs. It is labeled d. Multiband, Multitype FIR Filter. It consist of a waveform that has an extremely positive slope to begin with which peaks at (.25,1) and then immediately takes an equally negative slope down to the x axis. The wave then wavers a little along the x axis and then shoots straight up to the same peak as before and wavers a bit and then falls back the x axis wavers and repeats."><image src="../../media/figMB1.png" mime-type="image/png" width="386"/><image for="pdf" src="../../media/figMB1.eps" mime-type="application/postscript"/></media>
          
        <caption>Frequency Response and Zero Locations of FIR Filters Designed by Least Squared Error</caption></figure>
      </section>
    </section>
    <section id="uid66">
      <title>Weighted Least Integral Squares FIR Filter Design</title>
      <para id="id2265277">If the FIR filter design problem is posed as a weighted integral squared
error approximation problem, a simple analytical design formula as in
<link target-id="uid37"/> or <link target-id="uid61"/> is not possible (Recall that it is possible to
easily introduce weights in the discrete approximation problem
<link target-id="uid24"/>). In this section we consider a multiband generalization
<link target-id="bid10"/> of an approach which is a mixture of analytical formulas and
numerical solution of Toeplitz plus Hankel matrices which have been
presented in <link target-id="bid12"/>, <link target-id="bid13"/>, <link target-id="bid9"/>.</para>
      <para id="id2265323">The most general definition of the linear phase weighted least squares FIR
filter design problem <link target-id="bid12"/>, <link target-id="bid14"/>, <link target-id="bid15"/> defines the error measure
as in <link document="m16923" target-id="uid16">Equation 10 from Constrained Approximation and Mixed Criteria</link> by</para>
      <equation id="uid68">
        <m:math mode="display">
          <m:mrow>
            <m:mi>q</m:mi>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:mfrac>
              <m:mn>1</m:mn>
              <m:mi>π</m:mi>
            </m:mfrac>
            <m:msub>
              <m:mo>∫</m:mo>
              <m:mi>Ω</m:mi>
            </m:msub>
            <m:mi>W</m:mi>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:msup>
              <m:mrow>
                <m:mo>|</m:mo>
                <m:msub>
                  <m:mi>A</m:mi>
                  <m:mi>d</m:mi>
                </m:msub>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>ω</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mo>-</m:mo>
                <m:mi>A</m:mi>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>ω</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mo>|</m:mo>
              </m:mrow>
              <m:mn>2</m:mn>
            </m:msup>
            <m:mi>d</m:mi>
            <m:mi>ω</m:mi>
            <m:mo>.</m:mo>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2265440">where <m:math><m:mi>Ω</m:mi></m:math> is the set of frequencies that contribute to the error.</para>
      <para id="id2265456">We set up the conditions for minimizing the error in <link target-id="uid68"/> for odd <m:math><m:mi>N</m:mi></m:math>
by using the same approach used in <link target-id="bid9"/> which substitutes</para>
      <equation id="id2265479"><m:math mode="display">
          <m:mrow>
            <m:mi>A</m:mi>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mo>=</m:mo>
            <m:munderover>
<m:mrow>
              <m:mo>∑</m:mo>
</m:mrow>        
      <m:mrow>
                <m:mi>n</m:mi>
                <m:mo>=</m:mo>
                <m:mn>0</m:mn>
              </m:mrow>
              <m:mi>M</m:mi>
            </m:munderover>
            <m:mi>a</m:mi>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>n</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mo form="prefix">cos</m:mo>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mi>n</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2265546">from <link document="m16889" target-id="uid1009">Equation 34 from FIR Digital Filters</link> into <link target-id="uid68"/>, differentiates <m:math><m:mi>q</m:mi></m:math> in respect to each
<m:math><m:mrow><m:mi>a</m:mi><m:mo>(</m:mo><m:mi>m</m:mi><m:mo>)</m:mo></m:mrow></m:math>, and then sets it equal to zero to give</para>
      <equation id="uid69"><m:math mode="display">
          <m:mrow>
            <m:mfrac>
              <m:mn>1</m:mn>
              <m:mi>π</m:mi>
            </m:mfrac>
            <m:msub>
              <m:mo>∫</m:mo>
              <m:mi>Ω</m:mi>
            </m:msub>
            <m:mi>W</m:mi>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:msub>
              <m:mi>A</m:mi>
              <m:mi>d</m:mi>
            </m:msub>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mo form="prefix">cos</m:mo>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mi>m</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mi>d</m:mi>
            <m:mi>ω</m:mi>
            <m:mo>=</m:mo>
            <m:munderover>
<m:mrow>
              <m:mo>∑</m:mo>
</m:mrow>        
      <m:mrow>
                <m:mi>n</m:mi>
                <m:mo>=</m:mo>
                <m:mn>0</m:mn>
              </m:mrow>
              <m:mi>M</m:mi>
            </m:munderover>
            <m:mi>a</m:mi>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>n</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mfrac>
              <m:mn>2</m:mn>
              <m:mi>π</m:mi>
            </m:mfrac>
            <m:msub>
              <m:mo>∫</m:mo>
              <m:mi>Ω</m:mi>
            </m:msub>
            <m:mi>W</m:mi>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mo form="prefix">cos</m:mo>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mi>n</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mo form="prefix">cos</m:mo>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mi>m</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mi>d</m:mi>
            <m:mi>ω</m:mi>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2265758">where we can obtain the <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math> from the <m:math><m:mrow><m:mi>a</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math> by the scaling and shifting
in <link document="m16889" target-id="element-687">Equation 35 from FIR Digital Filters</link>.
We denote this in matrix form by</para>
      <equation id="uid70">
        <m:math mode="display">
          <m:mrow>
            <m:msub>
              <m:mi mathvariant="bold">A</m:mi>
              <m:mi mathvariant="bold">w</m:mi>
            </m:msub>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:msub>
              <m:mi mathvariant="bold">C</m:mi>
              <m:mi mathvariant="bold">w</m:mi>
            </m:msub>
            <m:mspace width="0.166667em"/>
            <m:mi mathvariant="bold">a</m:mi>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2265853">with the elements of the <m:math><m:mrow><m:mi>M</m:mi><m:mo>+</m:mo><m:mn>1</m:mn></m:mrow></m:math> by <m:math><m:mrow><m:mi>M</m:mi><m:mo>+</m:mo><m:mn>1</m:mn></m:mrow></m:math> matrix <m:math><m:msub><m:mi mathvariant="bold">C</m:mi><m:mi mathvariant="bold">w</m:mi></m:msub></m:math> as</para>
      <equation id="uid71">
        <m:math mode="display">
          <m:mrow>
            <m:msub>
              <m:mi>c</m:mi>
              <m:mi>w</m:mi>
            </m:msub>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>m</m:mi>
              <m:mo>,</m:mo>
              <m:mi>n</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:mfrac>
              <m:mn>2</m:mn>
              <m:mi>π</m:mi>
            </m:mfrac>
            <m:msub>
              <m:mo>∫</m:mo>
              <m:mi>Ω</m:mi>
            </m:msub>
            <m:mi>W</m:mi>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mo form="prefix">cos</m:mo>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mi>n</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mo form="prefix">cos</m:mo>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mi>m</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mi>d</m:mi>
            <m:mi>ω</m:mi>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2266015">and the <m:math><m:mrow><m:mi>M</m:mi><m:mo>+</m:mo><m:mn>1</m:mn></m:mrow></m:math> by 1 vector of intermediate values <m:math><m:msub><m:mi mathvariant="bold">a</m:mi><m:mi mathvariant="bold">w</m:mi></m:msub></m:math> is given by
an inverse DTFT of the weighted ideal amplitude response in</para>
      <equation id="uid72">
        <m:math mode="display">
          <m:mrow>
            <m:msub>
              <m:mi>A</m:mi>
              <m:mi>w</m:mi>
            </m:msub>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>n</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:mfrac>
              <m:mn>1</m:mn>
              <m:mi>π</m:mi>
            </m:mfrac>
            <m:msub>
              <m:mo>∫</m:mo>
              <m:mi>Ω</m:mi>
            </m:msub>
            <m:mi>W</m:mi>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:msub>
              <m:mi>A</m:mi>
              <m:mi>d</m:mi>
            </m:msub>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mo form="prefix">cos</m:mo>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mi>n</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mi>d</m:mi>
            <m:mi>ω</m:mi>
            <m:mspace width="4pt"/>
            <m:mspace width="4pt"/>
            <m:mspace width="4pt"/>
            <m:mspace width="4pt"/>
            <m:mspace width="4pt"/>
            <m:mtext>for</m:mtext>
            <m:mspace width="4.pt"/>
            <m:mrow>
              <m:mn>1</m:mn>
              <m:mo>≤</m:mo>
              <m:mi>n</m:mi>
              <m:mo>≤</m:mo>
              <m:mi>N</m:mi>
              <m:mo>-</m:mo>
              <m:mn>1</m:mn>
            </m:mrow>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2266198">and</para>
      <equation id="uid73">
        <m:math mode="display">
          <m:mrow>
            <m:msub>
              <m:mi>A</m:mi>
              <m:mi>w</m:mi>
            </m:msub>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mn>0</m:mn>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mo>=</m:mo>
            <m:mfrac>
              <m:mn>1</m:mn>
              <m:mrow>
                <m:mn>2</m:mn>
                <m:mi>π</m:mi>
              </m:mrow>
            </m:mfrac>
            <m:msub>
              <m:mo>∫</m:mo>
              <m:mi>Ω</m:mi>
            </m:msub>
            <m:mi>W</m:mi>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:msub>
              <m:mi>A</m:mi>
              <m:mi>d</m:mi>
            </m:msub>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>ω</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mi>d</m:mi>
            <m:mi>ω</m:mi>
            <m:mo>.</m:mo>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2266289">Solving <link target-id="uid70"/> for the optimal <m:math><m:mi mathvariant="bold">a</m:mi></m:math> which minimizes the
integral weighted squared error <link target-id="uid68"/> is formally done by</para>
      <equation id="uid74">
        <m:math mode="display">
          <m:mrow>
            <m:mi mathvariant="bold">a</m:mi>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:msubsup>
              <m:mi mathvariant="bold">C</m:mi>
              <m:mi mathvariant="bold">w</m:mi>
              <m:mrow>
                <m:mo>-</m:mo>
                <m:mn mathvariant="bold">1</m:mn>
              </m:mrow>
            </m:msubsup>
            <m:mspace width="0.166667em"/>
            <m:msub>
              <m:mi mathvariant="bold">A</m:mi>
              <m:mi mathvariant="bold">w</m:mi>
            </m:msub>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2266378">and more accurately done by special numerical algorithms. The case for
even <m:math><m:mi>N</m:mi></m:math> is easily derived by using <link document="m16889" target-id="uid11009">Equation 40 from FIR Digital Filters</link> to derive <link target-id="uid69"/>. The
actual length-<m:math><m:mi>N</m:mi></m:math> filter coefficients <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math> are then found from <m:math><m:mrow><m:mi>a</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math> using <link document="m16889" target-id="uid21009">Equation 41 from FIR Digital Filters</link>.
Note that if the weighting is unity across the pass, transition, and stop bands, <m:math><m:msub><m:mi mathvariant="bold">C</m:mi><m:mi mathvariant="bold">w</m:mi></m:msub></m:math>
is the identity matrix. <m:math><m:msub><m:mi mathvariant="bold">C</m:mi><m:mi mathvariant="bold">w</m:mi></m:msub></m:math> gives the effects of the weighting.</para>
      <para id="id2266486">A similar formula was derived by Fleischer <link target-id="bid12"/>, Tufts,
Rorabacher and Mosier
<link target-id="bid13"/>, by Schüssler <link target-id="bid16"/>, by Oetken, Parks, and
Schüssler <link target-id="bid17"/>, and by Burrus, Soewito, and Gopinath
<link target-id="bid9"/>, <link target-id="bid10"/> in addressing similar problems.</para>
      <para id="id2266527">If the integrals in <link target-id="uid71"/> and <link target-id="uid72"/> can be analytically evaluated,
the solution of the weighted squared error approximation is obtained by
solving <m:math><m:mrow><m:mi>M</m:mi><m:mo>+</m:mo><m:mn>1</m:mn></m:mrow></m:math> equations. Fortunately these equations can be analytically
evaluated for several interesting cases as was done for the unweighted
case. The even length-<m:math><m:mi>N</m:mi></m:math> case is derived in a similar way using
<link document="m16889" target-id="uid11009">Equation 40 from FIR Digital Filters</link> and <link document="m16889" target-id="uid21009">Equation 41 from FIR Digital Filters</link>. An alternate formulation could modify the
first column.</para>
      <para id="id2266574">In most practical situations where specifications are set in the
frequency domain, these filters are described in terms of frequency bands.
We have already seen the idea of single pass, stop, and transition bands.
We now allow multiple pass and stopbands separated by multiple transition
bands. In order to obtain analytical solutions of <link target-id="uid71"/> and <link target-id="uid72"/>
and to be consistent with usual practice, we restrict ourselves to
constant weights over each separately defined frequency band. The error
in <link target-id="uid68"/> now becomes</para>
      <equation id="uid75"><m:math mode="display">
          <m:mrow>
            <m:mi>q</m:mi>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:mfrac>
              <m:mn>1</m:mn>
              <m:mi>π</m:mi>
            </m:mfrac>
            <m:munder>
<m:mrow>
              <m:mo>∑</m:mo>
</m:mrow>        
      <m:mi>k</m:mi>
            </m:munder>
            <m:mfenced separators="" open="[" close="]">
              <m:msub>
                <m:mi>W</m:mi>
                <m:mi>k</m:mi>
              </m:msub>
              <m:msubsup>
                <m:mo>∫</m:mo>
                <m:mrow>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mi>k</m:mi>
                  </m:msub>
                </m:mrow>
                <m:msub>
                  <m:mi>ω</m:mi>
                  <m:mrow>
                    <m:mi>k</m:mi>
                    <m:mo>+</m:mo>
                    <m:mn>1</m:mn>
                  </m:mrow>
                </m:msub>
              </m:msubsup>
              <m:msup>
                <m:mrow>
                  <m:mo>|</m:mo>
                  <m:msub>
                    <m:mi>A</m:mi>
                    <m:msub>
                      <m:mi>d</m:mi>
                      <m:mi>k</m:mi>
                    </m:msub>
                  </m:msub>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>ω</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>-</m:mo>
                  <m:mi>A</m:mi>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>ω</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>|</m:mo>
                </m:mrow>
                <m:mn>2</m:mn>
              </m:msup>
              <m:mspace width="0.166667em"/>
              <m:mi>d</m:mi>
              <m:mi>ω</m:mi>
            </m:mfenced>
            <m:mo>.</m:mo>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2266734">where the weights are constant over each band and are given by <m:math><m:mrow><m:mi>W</m:mi><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow><m:mo>=</m:mo><m:msub><m:mi>W</m:mi><m:mi>k</m:mi></m:msub></m:mrow></m:math> in the <m:math><m:msup><m:mi>k</m:mi><m:mrow><m:mi>t</m:mi><m:mi>h</m:mi></m:mrow></m:msup></m:math> band defined by <m:math><m:mrow><m:msub><m:mi>ω</m:mi><m:mi>k</m:mi></m:msub><m:mo>&lt;</m:mo><m:mi>ω</m:mi><m:mo>&lt;</m:mo><m:msub><m:mi>ω</m:mi><m:mrow><m:mi>k</m:mi><m:mo>+</m:mo><m:mn>1</m:mn></m:mrow></m:msub></m:mrow></m:math>.
The desired amplitude <m:math><m:mrow><m:msub><m:mi>A</m:mi><m:msub><m:mi>d</m:mi><m:mi>k</m:mi></m:msub></m:msub><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> is likewise defined in the
<m:math><m:msup><m:mi>k</m:mi><m:mrow><m:mi>t</m:mi><m:mi>h</m:mi></m:mrow></m:msup></m:math> band and is hopefully simple enough to allow analytical
evaluation of the formula <link target-id="uid35"/> for the ideal impulse
response.</para>
      <para id="id2266875">The form of <link target-id="uid75"/> causes <link target-id="uid71"/> to become</para>
      <equation id="uid76"><m:math mode="display">
          <m:mrow>
            <m:msub>
              <m:mi>c</m:mi>
              <m:mi>w</m:mi>
            </m:msub>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>m</m:mi>
              <m:mo>,</m:mo>
              <m:mi>n</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:mfrac>
              <m:mn>2</m:mn>
              <m:mi>π</m:mi>
            </m:mfrac>
            <m:munder>
<m:mrow>
              <m:mo>∑</m:mo>
</m:mrow>        
      <m:mi>k</m:mi>
            </m:munder>
            <m:mfenced separators="" open="[" close="]">
              <m:msub>
                <m:mi>W</m:mi>
                <m:mi>k</m:mi>
              </m:msub>
              <m:msubsup>
                <m:mo>∫</m:mo>
                <m:mrow>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mi>k</m:mi>
                  </m:msub>
                </m:mrow>
                <m:msub>
                  <m:mi>ω</m:mi>
                  <m:mrow>
                    <m:mi>k</m:mi>
                    <m:mo>+</m:mo>
                    <m:mn>1</m:mn>
                  </m:mrow>
                </m:msub>
              </m:msubsup>
              <m:mo form="prefix">cos</m:mo>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>ω</m:mi>
                <m:mi>n</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mspace width="0.166667em"/>
              <m:mo form="prefix">cos</m:mo>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>ω</m:mi>
                <m:mi>m</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mspace width="0.166667em"/>
              <m:mi>d</m:mi>
              <m:mi>ω</m:mi>
            </m:mfenced>
            <m:mo>.</m:mo>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2267026">which has an analytical solution as given by</para>
      <equation id="uid77"><m:math mode="display">
          <m:mrow>
            <m:msub>
              <m:mi>c</m:mi>
              <m:mi>w</m:mi>
            </m:msub>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>m</m:mi>
              <m:mo>,</m:mo>
              <m:mi>n</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:mfrac>
              <m:mn>1</m:mn>
              <m:mi>π</m:mi>
            </m:mfrac>
            <m:munder>
<m:mrow>
              <m:mo>∑</m:mo>
</m:mrow>        
      <m:mi>k</m:mi>
            </m:munder>
            <m:msub>
              <m:mi>W</m:mi>
              <m:mi>k</m:mi>
            </m:msub>
            <m:mfenced separators="" open="[" close="]">
              <m:mfrac>
                <m:mrow>
                  <m:mo form="prefix">sin</m:mo>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>-</m:mo>
                    <m:mi>m</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mrow>
                      <m:mi>k</m:mi>
                      <m:mo>+</m:mo>
                      <m:mn>1</m:mn>
                    </m:mrow>
                  </m:msub>
                  <m:mo>-</m:mo>
                  <m:mo form="prefix">sin</m:mo>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>-</m:mo>
                    <m:mi>m</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mi>k</m:mi>
                  </m:msub>
                </m:mrow>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>n</m:mi>
                  <m:mo>-</m:mo>
                  <m:mi>m</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
              </m:mfrac>
              <m:mo>+</m:mo>
              <m:mfrac>
                <m:mrow>
                  <m:mo form="prefix">sin</m:mo>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>+</m:mo>
                    <m:mi>m</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mrow>
                      <m:mi>k</m:mi>
                      <m:mo>+</m:mo>
                      <m:mn>1</m:mn>
                    </m:mrow>
                  </m:msub>
                  <m:mo>-</m:mo>
                  <m:mo form="prefix">sin</m:mo>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>+</m:mo>
                    <m:mi>m</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mi>k</m:mi>
                  </m:msub>
                </m:mrow>
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:mi>n</m:mi>
                  <m:mo>+</m:mo>
                  <m:mi>m</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
              </m:mfrac>
            </m:mfenced>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2267245">which for <m:math><m:mi>F</m:mi></m:math> band edges has terms that are indeterminate for <m:math><m:mrow><m:mi>n</m:mi><m:mo>=</m:mo><m:mi>m</m:mi><m:mo>≠</m:mo><m:mn>0</m:mn></m:mrow></m:math>
with values</para>
      <equation id="uid78"><m:math mode="display">
          <m:mrow>
            <m:msub>
              <m:mi>c</m:mi>
              <m:mi>w</m:mi>
            </m:msub>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>n</m:mi>
              <m:mo>,</m:mo>
              <m:mi>n</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:mfrac>
              <m:mn>1</m:mn>
              <m:mi>π</m:mi>
            </m:mfrac>
            <m:mfenced separators="" open="{" close="}">
              <m:munderover>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow>        
        <m:mrow>
                  <m:mi>k</m:mi>
                  <m:mo>=</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
                <m:mrow>
                  <m:mi>F</m:mi>
                  <m:mo>-</m:mo>
                  <m:mn>2</m:mn>
                </m:mrow>
              </m:munderover>
              <m:msub>
                <m:mi>W</m:mi>
                <m:mi>k</m:mi>
              </m:msub>
              <m:mfenced separators="" open="[" close="]">
                <m:mrow>
                  <m:mo>(</m:mo>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mrow>
                      <m:mi>k</m:mi>
                      <m:mo>+</m:mo>
                      <m:mn>1</m:mn>
                    </m:mrow>
                  </m:msub>
                  <m:mo>-</m:mo>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mi>k</m:mi>
                  </m:msub>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mo>+</m:mo>
                <m:mfrac>
                  <m:mrow>
                    <m:mo form="prefix">sin</m:mo>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:mn>2</m:mn>
                      <m:mi>n</m:mi>
                      <m:msub>
                        <m:mi>ω</m:mi>
                        <m:mrow>
                          <m:mi>k</m:mi>
                          <m:mo>+</m:mo>
                          <m:mn>1</m:mn>
                        </m:mrow>
                      </m:msub>
                      <m:mo>)</m:mo>
                    </m:mrow>
                    <m:mo>-</m:mo>
                    <m:mo form="prefix">sin</m:mo>
                    <m:mrow>
                      <m:mo>(</m:mo>
                      <m:mn>2</m:mn>
                      <m:mi>n</m:mi>
                      <m:msub>
                        <m:mi>ω</m:mi>
                        <m:mi>k</m:mi>
                      </m:msub>
                      <m:mo>)</m:mo>
                    </m:mrow>
                  </m:mrow>
                  <m:mrow>
                    <m:mn>2</m:mn>
                    <m:mi>n</m:mi>
                  </m:mrow>
                </m:mfrac>
              </m:mfenced>
              <m:mo>+</m:mo>
              <m:msub>
                <m:mi>W</m:mi>
                <m:mrow>
                  <m:mi>F</m:mi>
                  <m:mo>-</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
              </m:msub>
              <m:mi>π</m:mi>
            </m:mfenced>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2267478">and for <m:math><m:mrow><m:mi>n</m:mi><m:mo>=</m:mo><m:mi>m</m:mi><m:mo>=</m:mo><m:mn>0</m:mn></m:mrow></m:math> as</para>
      <equation id="uid79"><m:math mode="display">
          <m:mrow>
            <m:msub>
              <m:mi>c</m:mi>
              <m:mi>w</m:mi>
            </m:msub>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mn>0</m:mn>
              <m:mo>,</m:mo>
              <m:mn>0</m:mn>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:mfrac>
              <m:mn>1</m:mn>
              <m:mi>π</m:mi>
            </m:mfrac>
            <m:mfenced separators="" open="{" close="}">
              <m:munderover>
<m:mrow>
                <m:mo>∑</m:mo>
</m:mrow>        
        <m:mrow>
                  <m:mi>k</m:mi>
                  <m:mo>=</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
                <m:mrow>
                  <m:mi>F</m:mi>
                  <m:mo>-</m:mo>
                  <m:mn>2</m:mn>
                </m:mrow>
              </m:munderover>
              <m:msub>
                <m:mi>W</m:mi>
                <m:mi>k</m:mi>
              </m:msub>
              <m:mn>2</m:mn>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:msub>
                  <m:mi>ω</m:mi>
                  <m:mrow>
                    <m:mi>k</m:mi>
                    <m:mo>+</m:mo>
                    <m:mn>1</m:mn>
                  </m:mrow>
                </m:msub>
                <m:mo>-</m:mo>
                <m:msub>
                  <m:mi>ω</m:mi>
                  <m:mi>k</m:mi>
                </m:msub>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mo>+</m:mo>
              <m:msub>
                <m:mi>W</m:mi>
                <m:mrow>
                  <m:mi>F</m:mi>
                  <m:mo>-</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
              </m:msub>
              <m:mn>2</m:mn>
              <m:mi>π</m:mi>
            </m:mfenced>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2267635">Since the matrix elements are functions of <m:math><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>-</m:mo><m:mi>m</m:mi><m:mo>)</m:mo></m:mrow></m:math> and <m:math><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>+</m:mo><m:mi>m</m:mi><m:mo>)</m:mo></m:mrow></m:math>, <m:math><m:mi mathvariant="bold">C</m:mi></m:math> is the
sum of a Toeplitz and a Hankel matrix. This matrix can always be
calculated and it simply depends on the set of band edges <m:math><m:msub><m:mi>ω</m:mi><m:mi>k</m:mi></m:msub></m:math> and the
band weights <m:math><m:msub><m:mi>W</m:mi><m:mi>k</m:mi></m:msub></m:math> but not on the ideal amplitude response <m:math><m:mrow><m:msub><m:mi>A</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math>.
The case for even <m:math><m:mi>N</m:mi></m:math> is similar but uses <link document="m16923" target-id="uid14">Equation 8 from Constrained Approximation and Mixed Criteria</link> rather than <link document="m16923" target-id="uid13">Equation 7 from Constrained Approximation and Mixed Criteria</link>
with <link target-id="uid68"/> to derive an appropriate form of <link target-id="uid77"/>.</para>
      <para id="id2267768">If there are <m:math><m:mi>F</m:mi></m:math> distinct band edges <m:math><m:msub><m:mi>ω</m:mi><m:mi>k</m:mi></m:msub></m:math>, the first and last are
<m:math><m:mrow><m:msub><m:mi>ω</m:mi><m:mn>1</m:mn></m:msub><m:mo>=</m:mo><m:mn>0</m:mn></m:mrow></m:math> and <m:math><m:mrow><m:msub><m:mi>ω</m:mi><m:mi>F</m:mi></m:msub><m:mo>=</m:mo><m:mi>π</m:mi></m:mrow></m:math>. This means part of the first term in
the sum of <link target-id="uid77"/> is always zero and part of the last is zero except
when <m:math><m:mrow><m:mi>n</m:mi><m:mo>=</m:mo><m:mi>m</m:mi><m:mo>=</m:mo><m:mn>0</m:mn></m:mrow></m:math> where it is <m:math><m:mi>π</m:mi></m:math>. Using these facts allows <link target-id="uid77"/> to be
written</para>
      <equation id="uid80"><m:math mode="display">
          <m:mrow>
            <m:msub>
              <m:mi>c</m:mi>
              <m:mi>w</m:mi>
            </m:msub>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>m</m:mi>
              <m:mo>,</m:mo>
              <m:mi>n</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:mfrac>
              <m:mn>1</m:mn>
              <m:mi>π</m:mi>
            </m:mfrac>
            <m:munderover>
<m:mrow>
              <m:mo>∑</m:mo>
</m:mrow>        
      <m:mrow>
                <m:mi>k</m:mi>
                <m:mo>=</m:mo>
                <m:mn>1</m:mn>
              </m:mrow>
              <m:mrow>
                <m:mi>F</m:mi>
                <m:mo>-</m:mo>
                <m:mn>2</m:mn>
              </m:mrow>
            </m:munderover>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:msub>
                <m:mi>W</m:mi>
                <m:mi>k</m:mi>
              </m:msub>
              <m:mo>-</m:mo>
              <m:msub>
                <m:mi>W</m:mi>
                <m:mrow>
                  <m:mi>k</m:mi>
                  <m:mo>+</m:mo>
                  <m:mn>1</m:mn>
                </m:mrow>
              </m:msub>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mfenced separators="" open="[" close="]">
              <m:mfrac>
                <m:mrow>
                  <m:mo form="prefix">sin</m:mo>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>-</m:mo>
                    <m:mi>m</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mrow>
                      <m:mi>k</m:mi>
                      <m:mo>+</m:mo>
                      <m:mn>1</m:mn>
                    </m:mrow>
                  </m:msub>
                </m:mrow>
                <m:mrow>
                  <m:mi>n</m:mi>
                  <m:mo>-</m:mo>
                  <m:mi>m</m:mi>
                </m:mrow>
              </m:mfrac>
              <m:mo>+</m:mo>
              <m:mfrac>
                <m:mrow>
                  <m:mo form="prefix">sin</m:mo>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:mi>n</m:mi>
                    <m:mo>+</m:mo>
                    <m:mi>m</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mrow>
                      <m:mi>k</m:mi>
                      <m:mo>+</m:mo>
                      <m:mn>1</m:mn>
                    </m:mrow>
                  </m:msub>
                </m:mrow>
                <m:mrow>
                  <m:mi>n</m:mi>
                  <m:mo>+</m:mo>
                  <m:mi>m</m:mi>
                </m:mrow>
              </m:mfrac>
            </m:mfenced>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2268062">which, together with appropriately modified <link target-id="uid78"/> and <link target-id="uid79"/>, are
good forms for programming. The Matlab program in the appendix contains
the details.</para>
      <para id="id2268079">Applying the form of <link target-id="uid75"/> to <link target-id="uid72"/> gives</para>
      <equation id="uid81"><m:math mode="display">
          <m:mrow>
            <m:msub>
              <m:mi>a</m:mi>
              <m:mi>w</m:mi>
            </m:msub>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>n</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:mfrac>
              <m:mn>1</m:mn>
              <m:mi>π</m:mi>
            </m:mfrac>
            <m:munder>
<m:mrow>
              <m:mo>∑</m:mo>
</m:mrow>        
      <m:mi>k</m:mi>
            </m:munder>
            <m:mfenced separators="" open="[" close="]">
              <m:msub>
                <m:mi>W</m:mi>
                <m:mi>k</m:mi>
              </m:msub>
              <m:msubsup>
                <m:mo>∫</m:mo>
                <m:mrow>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mi>k</m:mi>
                  </m:msub>
                </m:mrow>
                <m:msub>
                  <m:mi>ω</m:mi>
                  <m:mrow>
                    <m:mi>k</m:mi>
                    <m:mo>+</m:mo>
                    <m:mn>1</m:mn>
                  </m:mrow>
                </m:msub>
              </m:msubsup>
              <m:msub>
                <m:mi>A</m:mi>
                <m:msub>
                  <m:mi>d</m:mi>
                  <m:mi>k</m:mi>
                </m:msub>
              </m:msub>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>ω</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mspace width="0.166667em"/>
              <m:mo form="prefix">cos</m:mo>
              <m:mrow>
                <m:mo>(</m:mo>
                <m:mi>ω</m:mi>
                <m:mi>n</m:mi>
                <m:mo>)</m:mo>
              </m:mrow>
              <m:mspace width="0.166667em"/>
              <m:mi>d</m:mi>
              <m:mi>ω</m:mi>
            </m:mfenced>
            <m:mo>.</m:mo>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2268234">These integrals have been evaluated for the four basic filter types - constant
gain passband lowpass filter, linear gain passband lowpass filter,
differentiator plus lowpass filter, and Hilbert transformer plus lowpass
filter - giving simple design formulas in <link target-id="uid37"/>, <link target-id="uid41"/>,
<link target-id="uid46"/>, and <link target-id="uid50"/>.</para>
      <para id="id2268262">Each basic filter type plus the effects of a transition band can be
calculated and combined according to <link target-id="uid54"/>. An example low pass
filter with a weight of <m:math><m:msub><m:mi>W</m:mi><m:mn>1</m:mn></m:msub></m:math> in the passband and <m:math><m:msub><m:mi>W</m:mi><m:mn>2</m:mn></m:msub></m:math> in the transition
band is given for odd <m:math><m:mi>N</m:mi></m:math> gives for the intermediate coefficients
<m:math><m:mrow><m:msub><m:mover accent="true"><m:mi>h</m:mi><m:mo>^</m:mo></m:mover><m:mi>w</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> from <link target-id="uid72"/> are</para>
      <equation id="uid82">
        <m:math mode="display">
          <m:mrow>
            <m:msub>
              <m:mi>a</m:mi>
              <m:mi>w</m:mi>
            </m:msub>
            <m:mrow>
              <m:mo>(</m:mo>
              <m:mi>n</m:mi>
              <m:mo>)</m:mo>
            </m:mrow>
            <m:mspace width="0.166667em"/>
            <m:mo>=</m:mo>
            <m:mspace width="0.166667em"/>
            <m:msub>
              <m:mi>W</m:mi>
              <m:mn>1</m:mn>
            </m:msub>
            <m:mfenced separators="" open="[" close="]">
              <m:mfrac>
                <m:mrow>
                  <m:mo form="prefix">sin</m:mo>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>2</m:mn>
                    </m:msub>
                    <m:mi>n</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                  <m:mo>-</m:mo>
                  <m:mo form="prefix">sin</m:mo>
                  <m:mrow>
                    <m:mo>(</m:mo>
                    <m:msub>
                      <m:mi>ω</m:mi>
                      <m:mn>1</m:mn>
                    </m:msub>
                    <m:mi>n</m:mi>
                    <m:mo>)</m:mo>
                  </m:mrow>
                </m:mrow>
                <m:mrow>
                  <m:mi>π</m:mi>
                  <m:mi>n</m:mi>
                </m:mrow>
              </m:mfrac>
            </m:mfenced>
            <m:mo>+</m:mo>
            <m:msub>
              <m:mi>W</m:mi>
              <m:mn>2</m:mn>
            </m:msub>
            <m:mfenced separators="" open="[" close="]">
              <m:mfrac>
                <m:mrow>
                  <m:mo form="prefix">sin</m:mo>
                  <m:mo>(</m:mo>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mn>0</m:mn>
                  </m:msub>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mrow>
                  <m:mi>π</m:mi>
                  <m:mi>n</m:mi>
                </m:mrow>
              </m:mfrac>
              <m:msup>
                <m:mfenced separators="" open="(" close=")">
                  <m:mfrac>
                    <m:mrow>
                      <m:mo form="prefix">sin</m:mo>
                      <m:mo>(</m:mo>
                      <m:mi>Δ</m:mi>
                      <m:mi>n</m:mi>
                      <m:mo>/</m:mo>
                      <m:mi>p</m:mi>
                      <m:mo>)</m:mo>
                    </m:mrow>
                    <m:mrow>
                      <m:mi>Δ</m:mi>
                      <m:mi>n</m:mi>
                      <m:mo>/</m:mo>
                      <m:mi>p</m:mi>
                    </m:mrow>
                  </m:mfrac>
                </m:mfenced>
                <m:mi>p</m:mi>
              </m:msup>
              <m:mo>-</m:mo>
              <m:mfrac>
                <m:mrow>
                  <m:mo form="prefix">sin</m:mo>
                  <m:mo>(</m:mo>
                  <m:msub>
                    <m:mi>ω</m:mi>
                    <m:mn>1</m:mn>
                  </m:msub>
                  <m:mi>n</m:mi>
                  <m:mo>)</m:mo>
                </m:mrow>
                <m:mrow>
                  <m:mi>π</m:mi>
                  <m:mi>n</m:mi>
                </m:mrow>
              </m:mfrac>
            </m:mfenced>
          </m:mrow>
        </m:math>
      </equation>
      <para id="id2268563">A similar expression can be derived for even <m:math><m:mi>N</m:mi></m:math> using <link document="m16923" target-id="uid14">Equation 8 from Constrained Approximation and Mixed Criteria</link>.</para>
      <para id="id2268581">This means the left hand vector in <link target-id="uid70"/> can be calculated as a
weighted sum of inverse DTFTs such as in <link target-id="uid41"/> if the ideal desired
amplitude can be constructed from the four basic types in <link document="m16889">FIR Digital Filters</link>, each with optimal transition bands.</para>
      <para id="id2268599">If one or more of the integrals in <link target-id="uid81"/> has no analytical solution,
<m:math><m:mrow><m:msub><m:mi>a</m:mi><m:mi>w</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> can be calculated numerically using a truncated weighted
sum of inverse DFTs of a dense sampling of <m:math><m:mrow><m:msub><m:mi>A</m:mi><m:msub><m:mi>d</m:mi><m:mi>k</m:mi></m:msub></m:msub><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> or made up of
the passbands calculated from inverse DFTs and the transition bands added
by multiplying appropriately by sinc functions since constructing an
optimal spline transition function to be sampled would not be easy.</para>
      <para id="id2268665">This gives a very powerful design method that allows multi band weighted
least squares design of FIR filters. The calculation of the matrix <m:math><m:msub><m:mi mathvariant="bold">C</m:mi><m:mi mathvariant="bold">w</m:mi></m:msub></m:math> in <link target-id="uid70"/> is always possible using <link target-id="uid77"/>. Because using a
true “don't care" transition band with a weight of zero might causes ill
conditioning of <link target-id="uid70"/> for <m:math><m:mrow><m:mo>(</m:mo><m:msub><m:mi>f</m:mi><m:mi>s</m:mi></m:msub><m:mo>-</m:mo><m:msub><m:mi>f</m:mi><m:mi>p</m:mi></m:msub><m:mo>)</m:mo><m:mi>N</m:mi><m:mo>&gt;</m:mo><m:mn>12</m:mn></m:mrow></m:math> as discussed in
<link target-id="bid9"/>, one can add a spline transition function in <m:math><m:mrow><m:msub><m:mi>A</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> to
the definition in <link target-id="element-610"/> as done in <link target-id="uid82"/> and <link target-id="bid9"/>. A very
small weight used in the transition bands together with a spline
transition function will improve the conditioning of <link target-id="uid70"/> with minor
degradation of the optimality. This point needs further evaluation.</para>
      <para id="id2268795">By using an inverse FFT perhaps plus a sinc induced transition function to
calculate the components of <link target-id="uid81"/>, this method can be used to design
arbitrary shaped passbands. It can also be used for complex approximation
by applying it to the real and imaginary parts of the desired
<m:math><m:mrow><m:msub><m:mi>H</m:mi><m:mi>d</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> separately and using the full, nonsymmetric <m:math><m:mrow><m:mi>h</m:mi><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:math>.</para>
      <para id="id2268848">The form of the simultaneous equations <link target-id="uid70"/> that must be solved to
design a filter by this method is interesting. If the weights in all
pass, stop, and transition bands are unity, the <m:math><m:msub><m:mi mathvariant="bold">C</m:mi><m:mi mathvariant="bold">w</m:mi></m:msub></m:math> matrix is the
identity matrix and <m:math><m:msub><m:mover accent="true"><m:mi mathvariant="bold">h</m:mi><m:mo>^</m:mo></m:mover><m:mi mathvariant="bold">w</m:mi></m:msub></m:math> contains the filter coefficients.
As the weights become less and less uniform or equal, the <m:math><m:msub><m:mi mathvariant="bold">C</m:mi><m:mi mathvariant="bold">w</m:mi></m:msub></m:math>
matrix becomes poorer conditioned. If the weights for the transition
bands are zero, it is the smallest eigenvalues of <m:math><m:msub><m:mi mathvariant="bold">C</m:mi><m:mi mathvariant="bold">w</m:mi></m:msub></m:math> that control
the actual amplitude response <m:math><m:mrow><m:mi>A</m:mi><m:mo>(</m:mo><m:mi>ω</m:mi><m:mo>)</m:mo></m:mrow></m:math> in the transition bands. This
explains why numerical errors in solving <link target-id="uid70"/> show up primarily in the
transition bands. It also suggests this effect can be reduced by allowing
a small weight in the transition bands. Indeed, one can design long
filters by using spline transition functions with a small weight which
then allows different pass and stopband weights.</para>
      <section id="uid83">
        <title>Matlab Programs</title>
        <para id="id2268982">A Matlab program for designing multiband FIR filters using the weighted
least squares approximation described in <link target-id="uid80"/> and <link target-id="uid81"/> above
is included in the Appendix. The program assumes passbands and stopbands
that alternate with transition bands. The passbands are assumed to have
constant gain for simplicity but that could be generalized with the
results from <link document="m16889">FIR Digital Filters</link>. The first for
 loop constructs the
<m:math><m:mrow><m:msub><m:mover accent="true"><m:mi>h</m:mi><m:mo>^</m:mo></m:mover><m:mi>w</m:mi></m:msub><m:mrow><m:mo>(</m:mo><m:mi>n</m:mi><m:mo>)</m:mo></m:mrow></m:mrow></m:math> in <link target-id="uid72"/> by sequentially designing weighted bandpass
filters and a separately weighted transition band similar to the example
in <link target-id="uid82"/>. These are added together in this loop to give the vector
<m:math><m:msub><m:mi>h</m:mi><m:mi>w</m:mi></m:msub></m:math>
 in <link target-id="uid70"/>. The second for
 loop constructs the <m:math><m:mi mathvariant="bold">C</m:mi></m:math>
matrix in <link target-id="uid70"/> using the formula <link target-id="uid80"/>. Care must be taken to
correctly calculate the indeterminate values of sinc(0) and to properly
include the effects of <m:math><m:mrow><m:msub><m:mi>ω</m:mi><m:mi>F</m:mi></m:msub><m:mo>=</m:mo><m:mi>π</m:mi></m:mrow></m:math>.</para>
        <para id="id2269122">When one uses zero weights in the transition bands, the <m:math><m:mi mathvariant="bold">C</m:mi></m:math> matrix
becomes ill conditioned when the product of the filter length <m:math><m:mi>N</m:mi></m:math> and the
sum of the transition band widths in Hertz is much above 12. This is an
approximate rule which is somewhat affected by different passband and
stopband weights, but it gives an indication of when numerical problems
will occur. To reduce this problem, the program includes optimal spline
transition functions so that a small weight can be used to improve the
conditioning of <m:math><m:mi mathvariant="bold">C</m:mi></m:math> with minimal effect on the optimality of the
approximation.</para>
      </section>
      <section id="uid84">
        <title>Examples</title>
        <para id="id2269176">To illustrate the effects of using a weighted least squared error design
criterion, a simple length-21 linear phase lowpass FIR filter was
designed, with unity weighting in the pass and stop bands and zero
weighting in the transition band. The frequency response is shown in
<link target-id=""/>a. The same filter is designed with a weight of 100 in
the passband and the response is shown in <link target-id=""/>b and the
case for a weight of 100 in the stopband is shown in <link target-id=""/>c.
It is instructive to design many example filters and observe the effects
of different weights, use of spline vs zero weight transition bands, and
the effects of the transition band width on the pass and stopband
performance.</para>
        <figure id="uid85" orient="horizontal"><media id="id28333402" alt="This figure consist three graphs. The first graph is labeled Length-21 Lowpass FIR Filter Response, Least Squared error. It consist of a line extending to the right of the y axis and then intersecting another line that rises from the x axis. The lines along with the x and y axis form a rectangle. A wave form begins at the top of the rectangle. The wave wavers a little along the top of the rectangle and then falls to the x axis where is wavers as it makes it way to the left of the graph. The second graph is labeled Length 21 Weighted Passband Lowpass FIR Filter Response. The graph is essentially the same as the previous graph except for the absence of the rectangle and the waver of the wave along the x axis is much more pronounce. The third graph is labeled Length 21 Weighted Stopband Lowpass FIR Filter Response. This graph is similar to the previous to, but with this graph the waver of the initial segment is more pronounced and the waver of the section along the x axis is nearly non existent."><image src="../../media/figWLS.png" mime-type="image/png" width="360"/><image for="pdf" src="../../media/figWLS.eps" mime-type="application/postscript"/></media>
          
        <caption>Frequency Response of Length-21 FIR Filter Designed by Weighted
Least Squared Error</caption></figure>
        <para id="id2269220">The same specifications that were used in the design using optimal spline
transition functions of <link target-id="uid65"/>a is used in the design here
with unity weights in the stop and passbands and zero weights in the
transition bands. The result is fairly similar to the spline function
design and is shown in <link target-id="uid86"/>a for <m:math><m:mrow><m:mi>N</m:mi><m:mo>=</m:mo><m:mn>51</m:mn></m:mrow></m:math>. For lengths above
around 131, numerical errors resulted in erratic performance in the
transition bands. Indeed for this case, the use of the spline method would
probably be superior. The advantage of the weighted least squares method
is illustrated in <link target-id="uid86"/>b where the same specifications are
used but with a weight of 100 in the first passband, in
<link target-id="uid86"/>c where a weight of 100 is used in the second passband,
and in <link target-id="uid86"/>d where a weight of 100 is used in the third
passband. This use of weights is impossible using the spline method or any
windowing method.</para>
        <figure id="uid86" orient="horizontal"><media id="id28333537" alt="This figure consist of four graphs. The top left graph is labeled Length-51 Multiband FIR Filter. It consist of a waveform that starts along the x axis with a slight waver and the shoots up almost vertically to about y=.7 where the wave wavers until it drops slightly to about y=.5 wavers a little and falls back to the x axis wavers a little and shoots all the back up to about y=1. The second graph labeled Length-51 Weighted Multiband FIR Filter progresses exactly the same way as the previous graph wave, but the first upper wavering area is actually smooth and flat in this graph. There is an arrow pointing to this section labeling it as weighted. The bottom left graph is labeled Length-51 Weighted Multiband FIR Filter and it also progresses the same way as the previous two graph except the second area of wavering is smoothed and flat and labeled with and arrow as weighted. The final graph the bottom right is the same except the last and highest portion is now flat and smooth and marked as weighted with an arrow."><image src="../../media/figMB2.png" mime-type="image/png" width="427"/><image for="pdf" src="../../media/figMB2.eps" mime-type="application/postscript"/></media>
          
        <caption>Frequency Response of Length-15 FIR Filter Designed by Least
Squared Error</caption></figure>
      </section>
    </section>
    <section id="uid87">
      <title>Section Conclusions</title>
      <para id="id2269312">This section has derived the four basic ideal lowpass filters: the constant
gain passband lowpass filter, the linearly increasing gain passband
lowpass filter, the differentiator with a lowpass filter, and the Hilbert
transformer with a lowpass filter. It is shown that each of these can be
modified to allow a spline transition function by a simple weighting
function.</para>
      <para id="id2269321">Because of using an <m:math><m:msub><m:mi>L</m:mi><m:mn>2</m:mn></m:msub></m:math> approximation error criterion and because of the
orthogonality of the basis functions of the Fourier transform, it is shown
that an optimal multiband filter can be built from the linear combination
of these optimal building blocks. This new filter design method has the
flexibility of the Parks-McClellan algorithm but the simplicity of the
windowing methods. It is extremely fast and has no numerical problems.
Unlike the windowing methods, the new method allows explicit independent
control of multiple transition band edges and gives an optimal design.
Its only limitation is not allowing error weighting.</para>
      <para id="id2269350">We then derived a second method that likewise allowed multiple pass, stop,
and transition bands with arbitrary band edges, but also allowed
independent weighting of each frequency band. There are two limitations
on this method. For long filters with wide transition bands with zero
weights and where <m:math><m:mrow><m:mi>N</m:mi><m:mo>(</m:mo><m:msub><m:mi>f</m:mi><m:mi>p</m:mi></m:msub><m:mo>-</m:mo><m:msub><m:mi>f</m:mi><m:mi>s</m:mi></m:msub><m:mo>)</m:mo><m:mo>&gt;</m:mo><m:mn>12</m:mn></m:mrow></m:math>, the equations that must be solved are
ill conditioned. This can be partially addressed using optimal spline
functions with small weights in the transition bands. The second problem
is that solving a large number of simultaneous equations can be slow and
require considerable memory. These problems might be addressed by using
special Toeplitz or Toeplitz plus Hankel algorithms <link target-id="bid18"/> or some
iterative method.</para>
      <para id="id2269406">When should these methods be used? The second method which minimizes the
weighted integral squared error should be used anytime the original
problem dictates a squared error criterion and the product of the length
and transition band width is less than twelve, <m:math><m:mrow><m:mi>N</m:mi><m:mspace width="0.166667em"/><m:mo>(</m:mo><m:msub><m:mi>f</m:mi><m:mi>p</m:mi></m:msub><m:mo>-</m:mo><m:msub><m:mi>f</m:mi><m:mi>s</m:mi></m:msub><m:mo>)</m:mo><m:mo>&lt;</m:mo><m:mn>12</m:mn></m:mrow></m:math>. These
conditions are often met because the squared error is a measure of the
signal or noise energy and one seldom wants a long filter <emphasis>and</emphasis> a wide
transition band. Even though this method requires solution of a set of
simultaneous equations and is, therefore, slower than the spline
transition function method, it executes in a few seconds on a PC or
workstation and allows independent weighting of different frequency bands.</para>
      <para id="id2269466">The first method which uses spline functions in the ideal response
transition bands will design essentially arbitrarily long filters very
quickly but it will not allow any error weighting. Although artificial
transition functions are used in the ideal response, the optimized spline
functions are very close to the response actually obtained by the second
method with zero weighting in the transition band. This means the optimal
approximation to the ideal response with spline functions transition bands
is close to that obtained using the second numerical method. Comparisons
of these effects for a single band can be found in <link target-id="bid9"/>. If a
Chebyshev approximation is desired, the Parks-McClellan method should be
used although it too has numerical problems for long filters with wide
transition bands. If different error measures are wanted in different
bands, the iterative reweighted least squares (IRLS) algorithm
<link target-id="bid19"/> should be used. Recent research suggest that for many
practical signal specifications, a mixture of Chebyshev and least squares
is appropriate with no explicit transition bands <link target-id="bid20"/>.</para>
      <para id="id2269503">If the equations that must be solved to obtain the optimal filter
coefficients are ill-conditioned, an orthogonalization procedure can be
used to improve the conditioning <link target-id="bid21"/>.</para>
    </section>
    <section id="uid88">
      <title>Characteristics of Optimal <!--Math is not currently allowed in CNXML section title.--> Filters</title>
      <para id="id2269538">Gibbs phenomenon, transition band, pole-zero plots, etc. </para>
    </section>
    <section id="uid90">
      <title>Complex <!--Math is not currently allowed in CNXML section title.--> and Minimum Phase Approximation</title>
      <para id="id2269569">Here we talk about which methods also solve the complex approximation
problem. We talk about the minimum phase filter.</para>
      
    </section>
  </content>
  <bib:file>
    <bib:entry id="bid1">
      <bib:article>
<!--required fields-->
        <bib:author>Aaron, M. Robert</bib:author>
        <bib:title>The Use of Least Squares in System Design</bib:title>
        <bib:journal>IRE Transaction on Circuit Theory</bib:journal>
        <bib:year>1956</bib:year>
<!--optional fields-->
        <bib:volume>3</bib:volume>
        <bib:number>4</bib:number>
        <bib:pages>224–231</bib:pages>
        <bib:month>December</bib:month>
        <bib:note/>
      </bib:article>
    </bib:entry>
    <bib:entry id="bid15">
      <bib:article>
<!--required fields-->
        <bib:author>Algazi, V. Ralph and Suk, Minsoo</bib:author>
        <bib:title>On the Frequency Weighted Least-Square Design of Finite Duration Filters</bib:title>
        <bib:journal>IEEE Transactions on Circuits and Systems</bib:journal>
        <bib:year>1975</bib:year>
<!--optional fields-->
        <bib:volume>22</bib:volume>
        <bib:number>12</bib:number>
        <bib:pages>943–953</bib:pages>
        <bib:month>December</bib:month>
        <bib:note/>
      </bib:article>
    </bib:entry>
    <bib:entry id="bid19">
      <bib:article>
<!--required fields-->
        <bib:author>Burrus, C. S. and Barreto, J. A. and Selesnick, I. W.</bib:author>
        <bib:title>Iterative Reweighted Least Squares Design of FIR Filters</bib:title>
        <bib:journal>IEEE Transactions on Signal Processing</bib:journal>
        <bib:year>1994</bib:year>
<!--optional fields-->
        <bib:volume>42</bib:volume>
        <bib:number>11</bib:number>
        <bib:pages>2926–2936</bib:pages>
        <bib:month>November</bib:month>
        <bib:note/>
      </bib:article>
    </bib:entry>
    <bib:entry id="bid9">
      <bib:article>
<!--required fields-->
        <bib:author>Burrus, C. S. and Soewito, A. W. and Gopinath, R. A.</bib:author>
        <bib:title>Least Squared Error FIR Filter Design with Transition Bands</bib:title>
        <bib:journal>IEEE Transactions on Signal Processing</bib:journal>
        <bib:year>1992</bib:year>
<!--optional fields-->
        <bib:volume>40</bib:volume>
        <bib:number>6</bib:number>
        <bib:pages>1327–1340</bib:pages>
        <bib:month>June</bib:month>
        <bib:note/>
      </bib:article>
    </bib:entry>
    <bib:entry id="bid10">
      <bib:article>
<!--required fields-->
        <bib:author>Burrus, C. S.</bib:author>
        <bib:title>Multiband Least Squares FIR Filter Design</bib:title>
        <bib:journal>IEEE Transactions on Signal Processing</bib:journal>
        <bib:year>1995</bib:year>
<!--optional fields-->
        <bib:volume>43</bib:volume>
        <bib:number>2</bib:number>
        <bib:pages>412–421</bib:pages>
        <bib:month>February</bib:month>
        <bib:note/>
      </bib:article>
    </bib:entry>
    <bib:entry id="bid12">
      <bib:article>
<!--required fields-->
        <bib:author>Fleischer, P. E.</bib:author>
        <bib:title>Digital Realization of Complex Transfer Functions</bib:title>
        <bib:journal>Simulation</bib:journal>
        <bib:year>1966</bib:year>
<!--optional fields-->
        <bib:volume>6</bib:volume>
        <bib:number/>
        <bib:pages>171–180</bib:pages>
        <bib:month>March</bib:month>
        <bib:note/>
      </bib:article>
    </bib:entry>
    <bib:entry id="bid14">
      <bib:article>
<!--required fields-->
        <bib:author>Farden, David C. and Scharf, Louis L.</bib:author>
        <bib:title>Statistical Design of Nonrecursive Digital Filters</bib:title>
        <bib:journal>IEEE Transactions on ASSP</bib:journal>
        <bib:year>1974</bib:year>
<!--optional fields-->
        <bib:volume>22</bib:volume>
        <bib:number>3</bib:number>
        <bib:pages>188–196</bib:pages>
        <bib:month>June</bib:month>
        <bib:note/>
      </bib:article>
    </bib:entry>
    <bib:entry id="bid0">
      <bib:article>
<!--required fields-->
        <bib:author>Guillemin, Ernst A.</bib:author>
        <bib:title>What is Nature's Error Criterion?</bib:title>
        <bib:journal>IRE Transaction on Circuit Theory</bib:journal>
        <bib:year>1954</bib:year>
<!--optional fields-->
        <bib:volume>1</bib:volume>
        <bib:number/>
        <bib:pages>76</bib:pages>
        <bib:month>March</bib:month>
        <bib:note>Follow-up articles in September 1954 issue.</bib:note>
      </bib:article>
    </bib:entry>
    <bib:entry id="bid5">
      <bib:book>
<!--required fields-->
        <bib:author>Lawson, C. L. and Hanson, R. J.</bib:author>
        <bib:title>Solving Least Squares Problems</bib:title>
        <bib:publisher>Prentice-Hall</bib:publisher>
        <bib:year>1974</bib:year>
<!--optional fields-->
        <bib:volume/>
        <bib:series/>
        <bib:address>Inglewood Cliffs, NJ</bib:address>
        <bib:edition/>
        <bib:month/>
        <bib:note/>
      </bib:book>
    </bib:entry>
    <bib:entry id="bid3">
      <bib:book>
<!--required fields-->
        <bib:author>Luenberger, D. G.</bib:author>
        <bib:title>Optimization by Vector Space Methods</bib:title>
        <bib:publisher>John Wiley &amp; Sons</bib:publisher>
        <bib:year>1969</bib:year>
<!--optional fields-->
        <bib:volume/>
        <bib:series/>
        <bib:address>New York</bib:address>
        <bib:edition/>
        <bib:month/>
        <bib:note/>
      </bib:book>
    </bib:entry>
    <bib:entry id="bid11">
      <bib:book>
<!--required fields-->
        <bib:author>Moler, Cleve and Little, John and Bangert, Steve</bib:author>
        <bib:title>Matlab User's Guide</bib:title>
        <bib:publisher>The MathWorks, Inc.</bib:publisher>
        <bib:year>1989</bib:year>
<!--optional fields-->
        <bib:volume/>
        <bib:series/>
        <bib:address>South Natick, MA</bib:address>
        <bib:edition/>
        <bib:month/>
        <bib:note/>
      </bib:book>
    </bib:entry>
    <bib:entry id="bid18">
      <bib:article>
<!--required fields-->
        <bib:author>Merchant, G. A. and Parks, T. W.</bib:author>
        <bib:title>Efficient Solution of a Toeplitz-Plus-Hankel Coefficient Matrix System of Equations</bib:title>
        <bib:journal>IEEE Transactions on ASSP</bib:journal>
        <bib:year>1982</bib:year>
<!--optional fields-->
        <bib:volume>30</bib:volume>
        <bib:number>1</bib:number>
        <bib:pages>40–44</bib:pages>
        <bib:month>February</bib:month>
        <bib:note/>
      </bib:article>
    </bib:entry>
    <bib:entry id="bid21">
      <bib:article>
<!--required fields-->
        <bib:author>Okuda, Masahiro and Ikehara, Masaaki and ichi Takahashi, Shin</bib:author>
        <bib:title>Fast and Stable Least–Squares Approach for Linear Phase FIR Filters</bib:title>
        <bib:journal>IEEE Transactions on Signal Processing</bib:journal>
        <bib:year>to appear 1998</bib:year>
<!--optional fields-->
        <bib:volume>46</bib:volume>
        <bib:number/>
        <bib:pages/>
        <bib:month/>
        <bib:note/>
      </bib:article>
    </bib:entry>
    <bib:entry id="bid17">
      <bib:article>
<!--required fields-->
        <bib:author>Oetken, G. and Parks, T. W. and Schüssler, H. W.</bib:author>
        <bib:title>New Results in the Design of Digital Interpolators</bib:title>
        <bib:journal>IEEE Trans. on ASSP</bib:journal>
        <bib:year>1975</bib:year>
<!--optional fields-->
        <bib:volume>ASSP-23</bib:volume>
        <bib:number/>
        <bib:pages>301–309</bib:pages>
        <bib:month>June</bib:month>
        <bib:note>also in Selected Papers in DSP II, IEEE Press, 1975, page 167.</bib:note>
      </bib:article>
    </bib:entry>
    <bib:entry id="bid7">
      <bib:book>
<!--required fields-->
        <bib:author>Oppenheim, A. V. and Schafer, R. W.</bib:author>
        <bib:title>Discrete-Time Signal Processing</bib:title>
        <bib:publisher>Prentice-Hall</bib:publisher>
        <bib:year>1989</bib:year>
<!--optional fields-->
        <bib:volume/>
        <bib:series/>
        <bib:address>Englewood Cliffs, NJ</bib:address>
        <bib:edition/>
        <bib:month/>
        <bib:note/>
      </bib:book>
    </bib:entry>
    <bib:entry id="bid6">
      <bib:book>
<!--required fields-->
        <bib:author>Parks, T. W. and Burrus, C. S.</bib:author>
        <bib:title>Digital Filter Design</bib:title>
        <bib:publisher>John Wiley &amp; Sons</bib:publisher>
        <bib:year>1987</bib:year>
<!--optional fields-->
        <bib:volume/>
        <bib:series/>
        <bib:address>New York</bib:address>
        <bib:edition/>
        <bib:month/>
        <bib:note/>
      </bib:book>
    </bib:entry>
    <bib:entry id="bid16">
      <bib:book>
<!--required fields-->
        <bib:author>Schüssler, H. W.</bib:author>
        <bib:title>Digitale Signalverarbeitung II</bib:title>
        <bib:publisher>Lehrstuhl für Nachrichtentechnik</bib:publisher>
        <bib:year>1978, 1988</bib:year>
<!--optional fields-->
        <bib:volume/>
        <bib:series/>
        <bib:address>Universität Erlangen–Nürnberg, Erlangen, Germany</bib:address>
        <bib:edition/>
        <bib:month/>
        <bib:note>in German</bib:note>
      </bib:book>
    </bib:entry>
    <bib:entry id="bid20">
      <bib:article>
<!--required fields-->
        <bib:author>Selesnick, Ivan W. and Lang, Markus and Burrus, C. Sidney</bib:author>
        <bib:title>Constrained Least Square Design of FIR Filters without Explicitly Specified Transition Bands</bib:title>
        <bib:journal>IEEE Transactions on Signal Processing</bib:journal>
        <bib:year>1996</bib:year>
<!--optional fields-->
        <bib:volume>44</bib:volume>
        <bib:number>8</bib:number>
        <bib:pages>1879–1892</bib:pages>
        <bib:month>August</bib:month>
        <bib:note/>
      </bib:article>
    </bib:entry>
    <bib:entry id="bid8">
      <bib:article>
<!--required fields-->
        <bib:author>Schüssler, H. W. and Steffen, P.</bib:author>
        <bib:title>A Hybrid System for the Reconstruction of a Smooth Function from its Samples</bib:title>
        <bib:journal>Circuits, Systems, and Signal Processing</bib:journal>
        <bib:year>1984</bib:year>
<!--optional fields-->
        <bib:volume>3</bib:volume>
        <bib:number>3</bib:number>
        <bib:pages>295–314</bib:pages>
        <bib:month/>
        <bib:note/>
      </bib:article>
    </bib:entry>
    <bib:entry id="bid4">
      <bib:book>
<!--required fields-->
        <bib:author>Strang, Gilbert</bib:author>
        <bib:title>Linear Algebra and Its Applications</bib:title>
        <bib:publisher>Academic Press</bib:publisher>
        <bib:year>1976</bib:year>
<!--optional fields-->
        <bib:volume/>
        <bib:series/>
        <bib:address>New York</bib:address>
        <bib:edition/>
        <bib:month/>
        <bib:note/>
      </bib:book>
    </bib:entry>
    <bib:entry id="bid13">
      <bib:article>
<!--required fields-->
        <bib:author>Tufts, Donald W. and Rorabacher, Darold W. and Mosier, Wilbur E.</bib:author>
        <bib:title>Designing Simple, Effective Digital Filters</bib:title>
        <bib:journal>IEEE Transactions on Audio and Electroacoustics</bib:journal>
        <bib:year>1970</bib:year>
<!--optional fields-->
        <bib:volume>18</bib:volume>
        <bib:number>2</bib:number>
        <bib:pages>142–158</bib:pages>
        <bib:month>June</bib:month>
        <bib:note/>
      </bib:article>
    </bib:entry>
    <bib:entry id="bid2">
      <bib:inproceedings>
<!--required fields-->
        <bib:author>Weisburn, B. A. and Parks, T. W. and Shenoy, B. G.</bib:author>
        <bib:title>Error Criteria for Filter Design</bib:title>
        <bib:booktitle>Proceedings of the IEEE International Conference on Acoustics, Speech, and Signal Processing</bib:booktitle>
        <bib:year>1994</bib:year>
<!--optional fields-->
        <bib:editor/>
        <bib:volume>3</bib:volume>
        <bib:series/>
        <bib:pages>III:565–568</bib:pages>
        <bib:address>IEEE ICASSP-94, Adelaide, Australia</bib:address>
        <bib:month>April 19–22</bib:month>
        <bib:organization/>
        <bib:publisher/>
        <bib:note/>
      </bib:inproceedings>
    </bib:entry>
  </bib:file>
</document>